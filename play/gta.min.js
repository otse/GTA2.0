(function(){var t,s;s=typeof exports!=="undefined"&&exports!==null?exports:this;t={ply:null,x:0,y:0,DEF:{},DEV:false,C:{invisible:new THREE.MeshBasicMaterial({visible:false}),GODMODE:false,PII:Math.PI*2,CHUNKSPAN:6,CHUNITS:64*6,CTABLE:[[[-2,2],[-1,2],[0,2],[1,2],[2,2]],[[-2,1],[-1,1],[0,1],[1,1],[2,1]],[[-2,0],[-1,0],[0,0],[1,0],[2,0]],[[-2,-1],[-1,-1],[0,-1],[1,-1],[2,-1]],[[-2,-2],[-1,-2],[0,-2],[1,-2],[2,-2]]],ZOOM:{Z:250,INTR:260,MELEE:270,GUN:350,X:800,DEAD:250,PED:300,CAR:500},AROUNDS:[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]]},zoom:200,zoomoverride:0,entitypool:0,walkpool:0,drivepool:0,parkingspacepool:0,audio:{},ed:null,materials:{},settings:{hotlineCam:true,prefabChunks:true,localMaterials:false,simpleShading:false,fancyHeadlights:false},delta:0,base:.016,timestep:1,frame:0,keys:[],fingers:[],mouse:{},mouse2d:{},mouse3d:new THREE.Vector3,left:false,right:false,scaling:14,outside:0,ambient:16777215,intrcolor:15066597,manner:{},net:null,map:null,world:null,ply:null,minimap:null,interior:null,walks:[],drives:[],masks:{none:0,solid:1,organic:2,items:4,casings:8,intrsolid:22,introrganic:50,intritems:100},mmaps:{},textures:{},water:null,waters:[],wtime:0,wspeed:.15,wsq:0,EUIDS:0,BIDS:0,chunking:false,CURCHUNK:[-999,-999],CHUNKID:1,freezeCam:false};t.outside=t.ambient;s.gg=t;$(document).ready(function(){t.DEV=!!$("DEV").length;t.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);document.addEventListener("touchstart",function(t){return 1},{passive:false},false);document.addEventListener("touchend",function(t){return 1},false);document.addEventListener("touchmove",function(t){t.preventDefault();return 1},{passive:false},false);t.load();setTimeout("gg.connect()",800);return true});t.normalize=function(t){var s;s=t-2*Math.PI*Math.floor(t/(2*Math.PI));return s};t.load=function(){var s;t.loadsounds();t.map=new t.Map;t.map.getNosj();t.map.chunkify();s=new box2d.b2Vec2(0,0);t.world=new box2d.b2World(s,false);if(t.ed!=null){t.settings.hotlineCam=false}t.makepan();t.boot.call(t);t.prepare();t.animate();return true};t.onspawn=function(){var s;if(this.spawned){return}if(t.ed!=null){return}s=['"Respect is everything" ...',"Is that my phone ringing? ...","Where am I? ...","Should I check the controls? ...",'"I\'m just a hunk, a hunk of burning love" ...',"Should I do something? ..."];t.letterbox(s[Math.floor(Math.random()*s.length)]);this.spawned=true;return 1};t.worldstep=function(){t.world.Step(1/60,10,8);t.world.ClearForces();return true};t.connect=function(){t.net=new t.Net;return true};t.prepare=function(){var s,e,i,r,n,a,o;t.box=new THREE.BoxBufferGeometry(64,64,64);t.rotateplane(t.box,0,3);t.rotateplane(t.box,1,1);t.rotateplane(t.box,2,2);t.extraneous();for(e=i=1;i<=12;e=++i){this.waters.push(t.loadSty("special/water/"+e+".bmp"))}this.water=new THREE.MeshLambertMaterial({map:t.waters[0],color:t.ambient});t.camera.position.x=0;t.camera.position.y=0;t.arrow=new t.Arrow;$.getJSON("play/config.json",function(s){return t.config=s});$.getJSON("sons/cars.json",function(s){return t.cars=s});$.getJSON("sons/weps.json",function(s){return t.weps=s});$.getJSON("sons/activators.json",function(s){return t.activators=s});a=t.cars;for(n in a){r=a[n];r.name=n;t.Cars.TYPES[n]=new t.Cars(r)}if(!!~this.params.indexOf("ed")){new t.Editor}t.map.chunkCheck();t.inventory=new t.Inventory;new t.Tour;new t.Settings;if(t.settings.prefabChunks){t.bubble(`Building ${Object.keys(t.map.offChunks).length} city chunks...`);o=t.map.offChunks;for(e in o){s=o[e];s.show(true)}t.zoom=t.C.ZOOM.PED}return 1};t.combinations=function(t){var s=[];for(var e=0;e<1<<t;e++){var i=[];for(var r=0;r<t;r++){i.push(e&1<<r?"1":"0")}s.push(i.join(""))}return s};t.extraneous=function(){var s,e,i,r,n,a,o,h,l,g,p,u,d,c,m,f,y,v,b,w,_,x,E,k;t.boxes=[];k=t.combinations(5);for(l=0,g=k.length;l<g;l++){s=k[l];i=t.box.clone();i.gg={bin:s};t.boxes[s]=i;e=i.attributes;e.position.needsUpdate=true;e.uv.needsUpdate=true;e.normal.needsUpdate=true;v=Array.from(e.position.array);E=Array.from(e.uv.array);m=Array.from(e.normal.array);for(o=c=5;c>=0;o=--c){r=!parseInt(s[o]);if(!r){continue}n=t.C.faceNames[o];v.splice(o*12,12);E.splice(o*8,8);m.splice(o*12,12);e.position.count-=4;e.uv.count-=4;e.normal.count-=4;i.groups[o].rm=true;w=i.groups;for(h=f=0,p=w.length;f<p;h=++f){a=w[h];if(!(h>o)){continue}a.start-=6}}_=i.groups;for(o=y=0,u=_.length;y<u;o=++y){a=_[o];a.gg=t.C.faceNames[o]}i.groups=i.groups.filter(function(t){return!t.rm});x=i.groups;for(o=b=0,d=x.length;b<d;o=++b){a=x[o];if("top"===a.gg){i.gg.top=o;break}}e.position.array=new Float32Array(v);e.uv.array=new Float32Array(E);e.normal.array=new Float32Array(m)}return 1};t.quake=0;t.shake=function(){var t,s;t=Math.random()*360;s=this.quake/2;if(this.quake>0){this.quake-=.5}else{this.quake=0}this.camera.position.x+=s*Math.sin(t);return this.camera.position.y+=s*Math.cos(t)};t.animate=function(){var s,e,i,r,n,a;requestAnimationFrame(this.animate.bind(this));this.mouseat();this.delta=this.clock.getDelta();this.timestep=this.delta/this.base;if(this.timestep>10){this.timestep=1}this.wtime+=this.delta;if(this.wtime>=this.wspeed){this.wsq=this.wsq<11?this.wsq+1:1;this.water.map=this.waters[this.wsq];this.wtime=0}if(this.ed!=null){this.ed.update()}if(t.ply!=null){t.x=t.ply.props.x;t.y=t.ply.props.y}this.map.chunkCheck();if(this.keys[114]===1){if(this.minimap!=null){this.minimap.dtor();this.minimap=null}else{this.minimap=new this.Minimap}}this.aim=!!this.right;if(this.settings.hotlineCam){this.pan()}this.worldstep();this.map.step();this.zoompass();if(t.ply!=null&&!this.freezeCam){a=this.ichBinEineBee;if(t.mobile){a*=1.5}this.camera.position.z=(a!=null?a:250)+t.ply.props.z-64;this.camera.position.x=this.ply.props.x;this.camera.position.y=this.ply.props.y}this.shake();this.arrow.stick();this.render();n=this.keys;for(s=i=0,r=n.length;i<r;s=++i){e=n[s];if(e){this.keys[s]=2}}this.frame++;return true};t.ichBinEineBee=t.zoomoverride||t.zoom;t.zoompass=function(){var s,e;this.zoomoverride=this.keys[90]?this.C.ZOOM.Z:this.keys[88]&&t.ed==null?this.C.ZOOM.X:this.zoom===0?this.zoomoverride:0;e=this.zoomoverride||this.zoom;if(this.ichBinEineBee!==e){if(this.ichBinEineBee<e){s=e-this.ichBinEineBee;s=s<5?5:s;this.ichBinEineBee+=s/20;if(this.ichBinEineBee>e){this.ichBinEineBee=e}}else{s=this.ichBinEineBee-e;s=s<5?5:s;this.ichBinEineBee-=s/20;if(this.ichBinEineBee<e){this.ichBinEineBee=e}}}this.ichBinEineBee=this.ichBinEineBee;return true};t.Visual=class s{constructor(t){var s;this.props=t;this.type="Visual";this.vjson={};if((s=this.props.vjson)!=null?s.length:void 0){this.vjson=JSON.parse(this.props.vjson=this.props.vjson.replace(/\\/g,""))}if(this.props.r==null){this.props.r=0}if(this.props.interior==null){if(this.props.states!=null&&this.props.states.intr!=null){this.props.interior=!!this.props.states.intr}}}dtor(){if(this.props.net){t.scene.remove(this.mesh)}if(this.mesh!=null){this.mesh.ggsolid=null}return 0}pose(){if(this.mesh!=null){this.mesh.position.x=this.props.x;this.mesh.position.y=this.props.y;this.mesh.position.z=this.props.z;this.mesh.updateMatrix();this.mesh.updateMatrixWorld()}return 111}step(){return 0}patch(){return 0}build(s=false){if(!(s||this.props.net)){return}if(this.props.hide){return}t.scene.add(this.mesh);return 1}}}).call(this);(function(){var t,s,e,i;$(document).mousemove(function(t){gg.mouse={x:t.clientX,y:t.clientY};if(gg.ed!=null){gg.ed.mousing()}});gg.mouseat=function(){var t,s,e,i;i=new THREE.Vector3;this.mouse3d=new THREE.Vector3(gg.mouse.x/window.innerWidth*2-1,-(gg.mouse.y/window.innerHeight)*2+1,.5);i=this.mouse3d.clone();i.unproject(gg.camera);t=i.sub(gg.camera.position).normalize();s=-gg.camera.position.z/t.z;e=gg.camera.position.clone().add(t.multiplyScalar(s));this.mouse2d=e;return 1};$(document).mouseup(function(t){if(t.button===0){gg.left=0}if(t.button===2){gg.right=0}});$(document).mousedown(function(t){if(t.button===0){gg.left=1}if(t.button===2){gg.right=1}if(gg.ed!=null){gg.ed.click()}});$(document).on("contextmenu",function(){return false});document.onkeydown=document.onkeyup=function(t){var s;s=t.keyCode;if(t.type==="keydown"&&gg.keys[s]!==2){gg.keys[s]=1}else if(t.type==="keyup"){gg.keys[s]=0}if(!gg.keys[s]){delete gg.keys[s]}if(s===114){t.preventDefault()}if(gg.ed!=null){gg.ed.key()}return 1};gg.clonemanmaterial=function(t){var s;s=this.manMaterial.clone();t.material=s;t.mesh.material=s;s.map=gg.loadSty("nontile/man/template.png");s.color=new THREE.Color(16777215);s.specular=new THREE.Color(1118481);s.shininess=10;s.opacity=1;s.program=this.manMaterial.program;s.uniforms.soft.value=s.map;s.uniforms.skin.value=s.map;s.uniforms.feet.value=s.map;s.uniforms.legs.value=s.map;s.uniforms.body.value=s.map;s.uniforms.hair.value=s.map;s.uniforms.map.value=s.map;s.uniforms.diffuse.value=s.color;s.uniforms.specular.value=s.specular;s.uniforms.shininess.value=Math.max(s.shininess,1e-4);s.uniforms.opacity.value=s.opacity;gg.softfor(t,"nontile/man/template.png");return 1};gg.clonecarmaterial=function(t){var s;s=this.carMaterial.clone();t.material=s;t.mesh.material=s;s.map=gg.loadSty(t.path);s.color=new THREE.Color(16777215);s.specular=new THREE.Color(1118481);s.shininess=10;s.opacity=1;s.uniforms.soft.value=s.map;s.uniforms.map.value=s.map;gg.softfor(t,t.path);return 1};gg.softs=[];e=[];gg.softfor=function(t,s){var e,i,r,n;n=`play/sty/${s}`;if((e=gg.softs)[n]==null){e[n]=new THREE.Texture}r=gg.softs[n];t.material.uniforms.soft.value=r;t.material.uniforms.soft.needsUpdate=true;if(r.aye){return}r.aye=true;i=new Image;i.src=n;i.onload=function(){var t,s,e;t=gg.canvas.get(0);t.width=this.width;t.height=this.height;s=t.getContext("2d");s.drawImage(i,0,0);StackBlur.canvasRGBA(t,0,0,this.width,this.height,2);e=s.getImageData(0,0,this.width,this.height);i=new Image;i.src=t.toDataURL();r.image=i;r.needsUpdate=true;r.minFilter=THREE.LinearFilter;return 0};return 0};gg.createsoftcanvas=function(){this.canvas=$("<canvas/>",{id:"resizer"});this.canvas.css("display","none");this.canvas.css("position","absolute");this.canvas.css("left",0);this.canvas.css("top",0);$(document.body).append(this.canvas);return 1};gg.custommaterials=function(){var t;t=this.manMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib["phong"].uniforms,{soft:{value:null},skin:{value:null},feet:{value:null},legs:{value:null},body:{value:null},hair:{value:null},gun:{value:null}}]),defines:{MAN:""},transparent:true,lights:true,fog:true,vertexShader:THREE.ShaderChunk["meshphong_vert"],fragmentShader:document.getElementById("fairyFragmentShader").textContent});t.map=gg.loadSty("nontile/man/template.png");t.uniforms.soft.value=t.map;t.uniforms.skin.value=t.map;t.uniforms.feet.value=t.map;t.uniforms.legs.value=t.map;t.uniforms.body.value=t.map;t.uniforms.hair.value=t.map;t.uniforms.gun.value=t.map;t.uniforms.map.value=t.map;t.uniforms.diffuse.value=t.color;t.uniforms.specular.value=t.specular;t.uniforms.shininess.value=Math.max(t.shininess,1e-4);t.uniforms.opacity.value=t.opacity;t=this.carMaterial=new THREE.ShaderMaterial({defines:{CAR:""},uniforms:THREE.UniformsUtils.merge([THREE.ShaderLib["phong"].uniforms,{soft:{value:null}}]),transparent:true,lights:true,fog:true,vertexShader:THREE.ShaderChunk["meshphong_vert"],fragmentShader:document.getElementById("fairyFragmentShader").textContent});t.map=gg.loadSty("nontile/arrow.png");return 1};gg.boot=function(){var e;this.params=document.location.href.split("#");this.nosound=!!~this.params.indexOf("nosound");this.nostat=!!~this.params.indexOf("nostat");e=document.getElementById("container");this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1500);this.raycaster=new THREE.Raycaster;this.camera.position.z=this.zoomoverride||this.zoom;this.camera.position.x=0;this.camera.position.y=0;this.clock=new THREE.Clock;this.scene=new THREE.Scene;this.ambientlight=new THREE.AmbientLight(7697781);this.scene.add(this.ambientlight);this.moon=new THREE.DirectionalLight(11119036,.3);this.moon.castShadow=false;this.moon.position.set(0,0,100);this.moon.target.position.set(-50,-50,0);this.moon.shadow.camera.bottom=-512;this.moon.shadow.camera.left=-512;this.moon.shadow.camera.top=512;this.moon.shadow.camera.right=512;this.moon.shadow.mapSize.width=this.moon.shadow.mapSize.height=1024;gg.custommaterials();gg.createsoftcanvas();this.raycaster=new THREE.Raycaster;this.renderer=new THREE.WebGLRenderer;this.renderer.setSize(window.innerWidth,window.innerHeight);this.renderer.shadowMap.enabled=false;this.renderer.shadowMap.type=THREE.PCFSoftShadowMap;this.renderer.shadowMap.autoUpdate=false;this.renderer.shadowMap.needsUpdate=true;t.call(gg);this.maxAnisotropy=this.renderer.capabilities.getMaxAnisotropy();e.innerHTML="";e.appendChild(this.renderer.domElement);window.addEventListener("resize",s,false);gg.thumbs();return true};t=function(){this.listener=new THREE.AudioListener;this.listener.up=new THREE.Vector3(0,1,0);this.camera.add(this.listener);return false};gg.thumbs=function(){var t,s,e,i,r,n,a,o,h,l,g,p,u,d,c;if(!gg.mobile){return}gg.bubble('<span style="color: orange">Detected mobile; using experimental phone controls</span>');s=$('<div class="directions">');d=$("<div>").text("↑");i=$("<div>").text("↓");a=$("<div>").text("←");l=$("<div>").text("→");c=$("<div>").addClass("").text("e");g=$("<div>").addClass("arbitrary").text("shift");p=$("<div>").addClass("arbitrary").text("shoot");e=[];e.push({j:d,keycode:87});e.push({j:i,keycode:83});e.push({j:a,keycode:65});e.push({j:l,keycode:68});e.push({j:c,keycode:69});e.push({j:g,keycode:16});e.push({j:p,keycode:32});n=function(t,s,e){return gg.keys[s]=e};for(r=0,o=e.length;r<o;r++){h=e[r];(function(t){t.j.on({mousedown:function(s){return n(this,t.keycode,1)},touchstart:function(s){return n(this,t.keycode,1)}});return t.j.on({mouseup:function(s){return n(this,t.keycode,0)},touchend:function(s){return n(this,t.keycode,0)}})})(h)}u=function(){return $("<span>")};t=function(){return $("<br />")};s.append(u(),d,t(),a,i,l,t(),c,g,p);$("#overlay").append(s);return 1};gg.render=function(){this.renderer.render(this.scene,this.camera);if(this.ed!=null){this.raycaster.setFromCamera(this.mouse3d.clone(),this.camera)}return true};s=function(){gg.camera.aspect=window.innerWidth/window.innerHeight;gg.camera.updateProjectionMatrix();gg.renderer.setSize(window.innerWidth,window.innerHeight);return true};gg.sounds={music:["play/snd/scattle-inner-animal.mp3","play/snd/scattle-its-safe-now.mp3"],andremember:["play/snd/SFX_ICE_CREAM_VAN_TUNE_1.wav"],icecream:["play/snd/SFX_ICE_CREAM_VAN_TUNE_1.wav"],footsteps:["play/snd/SFX_FOOTSTEP_CONCRETE_1.wav","play/snd/SFX_FOOTSTEP_CONCRETE_2.wav","play/snd/SFX_FOOTSTEP_CONCRETE_3.wav","play/snd/SFX_FOOTSTEP_CONCRETE_4.wav"],elvis:["play/snd/SFX_ELVIS_1.wav","play/snd/SFX_ELVIS_6.wav"],hesgotagun:["play/snd/SFX_NEW_PED_DGOTGUN1.wav","play/snd/SFX_NEW_PED_DGOTGUN2.wav","play/snd/SFX_NEW_PED_DGOTGUN3.wav"],cardoor:["play/snd/SFX_CAR_DOOR_OPEN_1.wav","play/snd/SFX_CAR_DOOR_CLOSE_1.wav"],carengine:["play/snd/SFX_STANDARD_SALOON_ENGINE.wav","play/snd/SFX_SPORTS_SALOON_ENGINE.wav","play/snd/SFX_SUPERCAR_ENGINE.wav","play/snd/SFX_VAN_ENGINE.wav","play/snd/SFX_TRUCK_ENGINE.wav"],carenginestart:["play/snd/SFX_STARTER_MOTOR_1.wav","play/snd/SFX_STARTER_MOTOR_2.wav"],screams:["play/snd/SFX_NEW_PED_DSCREAM1.wav","play/snd/SFX_NEW_PED_DSCREAM2.wav","play/snd/SFX_NEW_PED_DSCREAM3.wav","play/snd/SFX_NEW_PED_DSCREAM4.wav","play/snd/SFX_NEW_PED_DONFIRE1.wav","play/snd/SFX_NEW_PED_DONFIRE2.wav","play/snd/SFX_NEW_PED_DONFIRE3.wav","play/snd/SFX_NEW_PED_DONFIRE4.wav","play/snd/SFX_NEW_PED_DONFIRE5.wav","play/snd/SFX_NEW_PED_DONFIRE6.wav"],kungfu:["play/snd/SFX_PUNCH_HIT.wav","play/snd/SFX_BULLET_PED.wav","play/snd/SFX_COLLISION_CAR_PED_SQUASH.wav"],impacts:["play/snd/SFX_BULLET_CAR_1.wav","play/snd/SFX_BULLET_CAR_2.wav","play/snd/SFX_BULLET_CAR_3.wav","play/snd/SFX_BULLET_PROOF_CAR_1.wav","play/snd/SFX_BULLET_PROOF_CAR_2.wav","play/snd/SFX_BULLET_PROOF_CAR_3.wav","play/snd/SFX_BULLET_WALL_1.wav","play/snd/SFX_BULLET_WALL_2.wav","play/snd/SFX_BULLET_WALL_3.wav"],M9:["play/snd/nongta2/M9.1.mp3","play/snd/nongta2/M9.2.mp3"],M1911:["play/snd/nongta2/M1911.1.mp3","play/snd/nongta2/M1911.2.mp3"],"FN 57":["play/snd/nongta2/FN 57.1.mp3","play/snd/nongta2/FN 57.3.mp3"],"Compact 45":["play/snd/nongta2/Compact 45.1.mp3","play/snd/nongta2/Compact 45.2.mp3"],"Desert Eagle":["play/snd/nongta2/Desert Eagle.1.mp3","play/snd/nongta2/Desert Eagle.2.mp3"],".44 Magnum":["play/snd/nongta2/.44 Magnum.1.mp3","play/snd/nongta2/.44 Magnum.2.mp3"],UMP:["play/snd/nongta2/UMP.2.mp3","play/snd/nongta2/UMP.4.mp3"],UMP:["play/snd/nongta2/UMP.2.mp3","play/snd/nongta2/UMP.4.mp3"],"Groza-1":["play/snd/nongta2/Groza-1.2.mp3","play/snd/nongta2/Groza-1.3.mp3"],"Magpul PDR":["play/snd/nongta2/Magpul PDR.1.mp3","play/snd/nongta2/Magpul PDR.2.mp3","play/snd/nongta2/Magpul PDR.3.mp3"],"Groza-4":["play/snd/nongta2/Groza-4.1.mp3","play/snd/nongta2/Groza-4.2.mp3"],G36C:["play/snd/nongta2/G36C.2.mp3","play/snd/nongta2/G36C.3.mp3"],M4A1:["play/snd/nongta2/M4A1.1.mp3","play/snd/nongta2/M4A1.2.mp3"],"AS Val":["play/snd/nongta2/AS Val.1.mp3","play/snd/nongta2/AS Val.2.mp3"],"AK-12":["play/snd/nongta2/AK-12.1.mp3","play/snd/nongta2/AK-12.3.mp3"],"AEK-971":["play/snd/nongta2/AEK-971.1.mp3","play/snd/nongta2/AEK-971.2.mp3"],"AN-94":["play/snd/nongta2/AN-94.1.mp3","play/snd/nongta2/AN-94.2.mp3","play/snd/nongta2/AN-94.3.mp3"],HK416:["play/snd/nongta2/M416.2.mp3","play/snd/nongta2/M416.3.mp3"],M16A4:["play/snd/nongta2/M16A4.1.mp3","play/snd/nongta2/M16A4.2.mp3"],"SCAR-H":["play/snd/nongta2/SCAR-H.1.mp3","play/snd/nongta2/SCAR-H.2.mp3"],"SPAS-12":["play/snd/nongta2/SPAS-12.1.mp3","play/snd/nongta2/SPAS-12.2.mp3"],"Mare's Leg":["play/snd/nongta2/Mare's Leg.1.mp3","play/snd/nongta2/Mare's Leg.2.mp3"],SKS:["play/snd/nongta2/SKS.1.mp3","play/snd/nongta2/SKS.2.mp3"],"SVD-12":["play/snd/nongta2/SVD-12.1.mp3","play/snd/nongta2/SVD-12.2.mp3"],"Scout Elite":["play/snd/nongta2/Scout Elite.1.mp3","play/snd/nongta2/Scout Elite.3.mp3"],M40A5:["play/snd/nongta2/M40A5.1.mp3","play/snd/nongta2/M40A5.2.mp3"],Intervention:["play/snd/nongta2/M40A5.1.mp3","play/snd/nongta2/M40A5.2.mp3"]};i=0;gg.loadsounds=function(){var t,s,e,i,r,n;r=gg.sounds;for(i in r){t=r[i];for(e in t){n=t[e];s=function(){var t,s;t=new THREE.AudioLoader;s=n;return t.load(s,function(t){var e,i;e=(i=gg.audio)[s]!=null?i[s]:i[s]=t})};s()}}return 1}}).call(this);(function(){var t,s,e,i,r,n;gg.visualFactory=function(t){var s;s=function(){switch(t.type){case"Surface":return new gg.Surface(t);case"Block":return new gg.Block(t);case"Neon":return new gg.Neon(t);case"Entity":return new gg.Entity(t);case"Light":return new gg.Light(t);case"Walk":return new gg.Walk(t);case"Drive":return new gg.Drive(t);case"Parking space":return new gg.ParkingSpace(t);case"Safe Zone":return new gg.SafeZone(t);case"Player":return new gg.Player(t);case"Zombie":return new gg.Zombie(t);case"Man":return new gg.Man(t);case"Car":return new gg.Car(t);case"Decal":return new gg.Decal(t);case"Door":return new gg.Door(t);case"Tree":return new gg.Tree(t);case"Table":return new gg.Activator(t);case"Desk":return new gg.Activator(t);case"Chair":return new gg.Activator(t);case"Couch":return new gg.Activator(t);case"Generator":return new gg.Generator(t);case"Worklight":return new gg.Worklight(t);case"Lab Freezer":return new gg.LabFreezer(t);case"Vacuum Oven":return new gg.VacuumOven(t);case"Incubator":return new gg.Incubator(t);case"Terminal":return new gg.Terminal(t);case"Teleporter":return new gg.Teleporter(t);case"ATM":return new gg.ATM(t);case"Vending Machine":return new gg.VendingMachine(t);case"Dumpster":return new gg.Dumpster(t);case"Pickup":return new gg.Pickup(t);default:console.error(`unknown visual type \`${t.type}\``);return s=new gg.Visual(t)}}();return s};gg.mksty=function(t,s){var e,i;e=t.split(".");i=e[0].lastIndexOf("/");return`${e[0]}${s}.${e[1]}`;return 0};gg.addrtochunk=function(t){var s,e,i;e=Math.floor(t.x/gg.C.CHUNITS);i=Math.floor(t.y/gg.C.CHUNITS);s=`${e},${i}`;gg.map.offChunks[s].addr(t);console.log(`adding to ${e},${i}`);return true};gg.play=function(t,s,e){var i,r;if(gg.nosound){return}if(Array.isArray(t)){t=t[Math.floor(Math.random()*t.length)]}r=gg.audio[t];if(!(r instanceof AudioBuffer)){return}i=new THREE.PositionalAudio(gg.listener);i.setBuffer(r);i.position.set(s.props.x,s.props.y,s.props.z);i.setRefDistance(e||30);i.play();gg.scene.add(i);return 1};gg.distant=function(t,s,e,i){return 1};gg.loadSty=function(t,s=false,e){var i,r;if(e==null){e=t}r=`play/sty/${t}`;if(!gg.textures[e]){THREE.TextureLoader();i=new THREE.TextureLoader;gg.textures[e]=i.load(r,function(t){t.generateMipmaps=false;if(!s){t.magFilter=THREE.NearestFilter;return t.minFilter=THREE.NearestFilter}})}return gg.textures[e]};gg.bubble=function(t,s){this.r=$('<div class="bubble">');this.e=$('<div class="in">');this.r.append(this.e);this.e.append(t);$("#bubbles").append(this.r);this.r.animate({"margin-top":0,opacity:1},600);this.slideaway=function(){var t;t=this.e;t.delay(7e3).animate({"margin-left":-(t.width()+40),opacity:0},1200,function(){return $(this).remove()});return true};if(!s){this.slideaway()}return this};gg.anim=function(t){if(t){delete this.timer;delete this.i;delete this.done;delete this.first;return}if(this.done==null){this.done=false}this.timer=this.timer!=null?this.timer+gg.delta:0;if(this.i==null){this.i=this.start||0}if(!(this.timer>=this.moment)){return}if(this.i===this.frames-1){this.done=true;this.i=-1}else if(this.start!=null&&this.first&&this.i===this.start){this.done=true;this.i=-1}else if(this.i===0){this.done=false;if(this.inverse){this.i=this.frames-1}}if(this.inverse){this.i--}else{this.i++}this.timer=0;if(this.first==null){this.first=true}return 1};gg.posplane=function(t,s,e,i,r,n){var a,o,h,l;l=s*8;a=[e,i+n,e+r,i+n,e,i,e+r,i];for(o=h=0;h<=7;o=++h){t.attributes.uv.array[l+o]=a[o]}t.attributes.uv.needsUpdate=true;return 100110};gg.flipplane=function(t,s,e,i){var r,n,a,o,h,l;h=s*8;r=t.attributes.uv.array;n=[[r[h+0],r[h+1],r[h+2],r[h+3],r[h+4],r[h+5],r[h+6],r[h+7]],[r[h+2],r[h+3],r[h+0],r[h+1],r[h+6],r[h+7],r[h+4],r[h+5]]];l=e?1:0;for(a=o=0;o<=7;a=++o){t.attributes.uv.array[h+a]=n[l][a]}t.attributes.uv.needsUpdate=true;return true};gg.rotateplane=function(t,s,e){var i,r,n,a;a=s*8;i=t.attributes.uv.array;switch(e){case 1:i=[i[a+4],i[a+5],i[a+0],i[a+1],i[a+6],i[a+7],i[a+2],i[a+3]];break;case 2:i=[i[a+6],i[a+7],i[a+4],i[a+5],i[a+2],i[a+3],i[a+0],i[a+1]];break;case 3:i=[i[a+2],i[a+3],i[a+6],i[a+7],i[a+0],i[a+1],i[a+4],i[a+5]]}for(r=n=0;n<=7;r=++n){t.attributes.uv.array[a+r]=i[r]}t.attributes.uv.needsUpdate=true;return true};gg.rotateUv=function(t,s,e){var i,r,n,a,o,h,l,g,p,u,d;l=[];if(s>0){for(r=a=0,g=s-1;0<=g?a<=g:a>=g;r=0<=g?++a:--a){l.push(null)}}i=s;d=s+1;switch(e){case 1:l.push([{x:t[i][1].x,y:t[i][1].y},{x:t[d][1].x,y:t[d][1].y},{x:t[i][0].x,y:t[i][0].y}]);l.push([{x:t[d][1].x,y:t[d][1].y},{x:t[i][2].x,y:t[i][2].y},{x:t[i][0].x,y:t[i][0].y}]);break;case 2:l.push([{x:t[d][1].x,y:t[d][1].y},{x:t[d][2].x,y:t[d][2].y},{x:t[d][0].x,y:t[d][0].y}]);l.push([{x:t[i][2].x,y:t[i][2].y},{x:t[i][0].x,y:t[i][0].y},{x:t[i][1].x,y:t[i][1].y}]);break;case 3:l.push([{x:t[i][2].x,y:t[i][2].y},{x:t[i][0].x,y:t[i][0].y},{x:t[d][1].x,y:t[d][1].y}]);l.push([{x:t[i][0].x,y:t[i][0].y},{x:t[d][0].x,y:t[d][0].y},{x:t[d][1].x,y:t[d][1].y}]);break;default:return}for(n=o=p=i,u=d;p<=u?o<=u:o>=u;n=p<=u?++o:--o){for(r=h=0;h<=2;r=++h){t[n][r].x=l[n][r].x;t[n][r].y=l[n][r].y}}return true};gg.flipUv=function(t,s,e){var i,r,n;i=[[[0,1],[0,0],[1,1]],[[0,0],[1,0],[1,1]]];r=[[[1,1],[1,0],[0,1]],[[1,0],[0,0],[0,1]]];n=e?r:i;t[s][0].x=n[0][0][0];t[s][0].y=n[0][0][1];t[s][1].x=n[0][1][0];t[s][1].y=n[0][1][1];t[s][2].x=n[0][2][0];t[s][2].y=n[0][2][1];t[s+1][0].x=n[1][0][0];t[s+1][0].y=n[1][0][1];t[s+1][1].x=n[1][1][0];t[s+1][1].y=n[1][1][1];t[s+1][2].x=n[1][2][0];t[s+1][2].y=n[1][2][1];return 1};gg.pivot=function(t,s,e,i,r){var n,a;n=i+(t-i)*Math.cos(e)-(s-r)*Math.sin(e);a=r+(t-i)*Math.sin(e)+(s-r)*Math.cos(e);return{x:n,y:a}};gg.shadeColor2=function(t,s){var e,i,r,n,a,o;n=parseInt(t.slice(1),16);o=s<0?0:255;a=s<0?s*-1:s;r=n>>16;i=n>>8&255;e=n&255;return(16777216+(Math.round((o-r)*a)+r)*65536+(Math.round((o-i)*a)+i)*256+(Math.round((o-e)*a)+e)).toString(16).slice(1)};gg.darker=function(t){var s,e;s=!(t!=null?t.props.interior:void 0)?gg.ambient:gg.intrcolor;s=`#${s.toString(16)}`;s=s.toUpperCase();e=parseInt(`0x${gg.shadeColor2(s,-.1)}`);return e};e=0;gg.material=function(t,s,i,r){var n,a,o,h;if(i==null){i=""}if(gg.ed!=null){i=`${i}Unique${e++}`}if(s!=null){if(s.props.interior){i=`${i}Interior`}if(gg.settings.localMaterials&&s.chunk!=null){i=`${i}Chunk${s.chunk.hash}`}}a=`${t}${i}`;n=gg.definitions[t];o=null;if(n!=null){o=gg.loadSty(n!=null?n.normalPath:void 0)}if(gg.materials[a]==null){if(r){h={map:gg.loadSty(t),transparent:!!~t.indexOf(".png"),side:THREE.FrontSide};gg.materials[a]=new THREE.MeshLambertMaterial(h)}else{h={map:gg.loadSty(t),specularMap:gg.loadSty(t),normalMap:o,normalScale:new THREE.Vector2(.5,.5),shininess:6,transparent:!!~t.indexOf(".png"),side:THREE.FrontSide};gg.materials[a]=new THREE.MeshPhongMaterial(h)}if(!!~i.indexOf("Sloped")){gg.materials[a].color=new THREE.Color(gg.darker(s))}}return gg.materials[a]};i={normalPath:"nontile/man/normal.png",seeThrough:true};s={normalPath:"nontile/cars/bugnormal.png"};r={normalPath:"nontile/cars/trucknormal.png"};n={normalPath:"nontile/cars/wellardnormal.png"};t={normalPath:"nontile/cars/anistonbd4normal.png"};gg.definitions={"nontile/man/white.png":i,"nontile/man/ponchohood.png":i,"nontile/man/surgical.png":i,"nontile/man/gloves.png":i,"nontile/man/leather.png":i,"nontile/man/black.png":i,"nontile/man/loafers.png":i,"nontile/man/sneakers.png":i,"nontile/man/dress.png":i,"nontile/man/jeans.png":i,"nontile/man/denim.png":i,"nontile/man/khaki.png":i,"nontile/man/poncho.png":i,"nontile/man/sweater.png":i,"nontile/man/bomber.png":i,"nontile/man/parka.png":i,"nontile/man/commando.png":i,"nontile/man/shirt.png":i,"nontile/man/brown.png":i,"nontile/man/bald.png":i,"nontile/man/blackhair.png":i,"nontile/man/handgun.png":i,"nontile/man/smg.png":i,"nontile/man/carbine.png":i,"nontile/man/ar.png":i,"nontile/man/shotgun.png":i,"nontile/man/dmr.png":i,"nontile/man/sniper.png":i,"nontile/cars/schoolbus.png":{normalPath:"nontile/cars/schoolbusnormal.png"},"nontile/cars/firetruck.png":{normalPath:"nontile/cars/firetrucknormal.png"},"nontile/cars/specialagentcar.png":{normalPath:"nontile/cars/specialagentcarnormal.png"},"nontile/cars/landroamer.png":{normalPath:"nontile/cars/landroamernormal.png"},"nontile/cars/bug.png":s,"nontile/cars/bug_blue.png":s,"nontile/cars/truck.png":r,"nontile/cars/wellard.png":n,"nontile/cars/anistonbd4.png":t}}).call(this);(function(){var t;t=function(t="PointLight"){var s,e;s=gg.mobile?5:8;gg.bubble(`Light Manager &lt;${t}&gt; ( ${s} )`);e={pool:[],_pooled:0,lights:[],blacks:[],first:function(){var e,i,r;console.log(`Light Manager <${t}>`);for(e=1,r=s;1<=r?e<=r:e>=r;1<=r?e++:e--){i=new THREE.PointLight(0,0,0);i.position.z=-5e3;this.blacks.push(i)}return 1},register:function(t){this.pool.unshift(t);this.process();return 0},process:function(){var t,e,i,r,n,a,o,h,l,g;g=this.pool;for(r=0,o=g.length;r<o;r++){a=g[r];gg.scene.remove(a)}e=function(t,s){var e,i;e=t.position.clone().distanceToSquared(gg.camera.position.clone());i=s.position.clone().distanceToSquared(gg.camera.position.clone());return e-i};t=function(t){var s,e,i,r,n;r=t._visual;i=r.props;s=gg.interior!=null&&gg.interior.name===i.interior;e=gg.interior==null&&i.interior==null;n=s||e;return n};l=this.pool.slice(0);l=l.filter(t);l=l.concat(this.blacks);l.sort(e);i=l.slice(0,s);for(n=0,h=i.length;n<h;n++){a=i[n];gg.scene.add(a)}this.lights=i;this._pooled=`${this.pool.length} of ${s} max`;return 1},checkoff:function(t){this.pool.splice(this.pool.indexOf(t),1);this.process();return 0}};e.first();return e};gg.Map=class s{constructor(){var s,e;this.mesh=new THREE.Mesh;this.meshes=[];this.copy=[];this.chunks=[];for(s=e=0;e<=4;s=++e){this.chunks[s]=[null,null,null,null,null]}this.build=false;this.actives=[];this.offChunks=[];this.load=false;gg.lightmanager=t()}getNosj(){var t;$.ajaxSetup({async:false});t=this;$.getJSON("sons/nosj.json",function(s){return t.nosj=s});return true}chunkify(){var t,s,e,i,r,n,a,o;r=this.nosj.visuals;t:for(s=0,e=r.length;s<e;s++){i=r[s];switch(i.type){case"Pickup":console.log("its a pu");if(gg.ed==null){continue t}break;case"Block":case"Surface":case"Light":case"Door":case"Neon":n=Math.floor(i.x/gg.C.CHUNKSPAN);o=Math.floor(i.y/gg.C.CHUNKSPAN);break;default:n=Math.floor(i.x/64/gg.C.CHUNKSPAN);o=Math.floor(i.y/64/gg.C.CHUNKSPAN)}a=`${n},${o}`;t=this.offChunks[a]||(this.offChunks[a]=new gg.Chunk(n,o));t.addr(i);if(gg.DEV){gg.idpoolforprops(i)}}return true}chunkCheck(){var t,s,e;gg.lightmanager.process();e=this.n={};e.x=Math.floor(gg.x/gg.C.CHUNITS);e.y=Math.floor(gg.y/gg.C.CHUNITS);t={};t.x=gg.CURCHUNK[0]-e.x;t.y=-(gg.CURCHUNK[1]-e.y);s=t.x||t.y;if(this.load&&!s){return}gg.CURCHUNK[0]=e.x;gg.CURCHUNK[1]=e.y;if(s||!this.load){this.shift(e,t)}this.load=true;return true}prepare(){var t,s,e;for(t=s=0;s<=4;t=++s){this.copy[t]=this.chunks[t].slice(0)}for(t=e=0;e<=4;t=++e){this.chunks[t]=[null,null,null,null,null]}return true}shift(t,s){var e,i,r,n,a,o,h,l,g;this.actives=[];this.prepare();for(g=r=0;r<=4;g=++r){for(h=n=0;n<=4;h=++n){a={};a.x=gg.C.CTABLE[g][h][0]+t.x;a.y=gg.C.CTABLE[g][h][1]+t.y;l=`${a.x},${a.y}`;o=gg.Map.v={x:h-s.x,y:g-s.y};if(o.x>=0&&o.y>=0&&o.x<5&&o.y<5){i=this.chunks[g][h]=this.copy[o.y][o.x]||null;e=this.copy[g][h]||null;if(i){this.actives.push(i)}if(e&&(e.x>t.x+2||e.x<t.x-2||e.y>t.y+2||e.y<t.y-2)){e.disappear()}else if(!i&&(h>0&&h<4&&g>0&&g<4)){e=this.chunks[g][h]=this.offChunks[l]||null;if(e){e.show();this.actives.push(e)}}}}}this.relit();if(gg.ed!=null){this.mesheseru()}if(gg.minimap!=null){gg.minimap.build()}if(gg.ed!=null){gg.map.cyancubes();gg.map.plaster()}return true}relit(){var t,s;gg.renderer.shadowMap.needsUpdate=true;t=gg.CURCHUNK[0]+.5*gg.C.CHUNITS;s=gg.CURCHUNK[1]+.5*gg.C.CHUNITS;gg.moon.position.set(t,s,300);gg.moon.target.position.set(t+96,s-96,0);return 1}step(){var t,s,e,i,r,n,a,o,h,l,g,p,u,d,c;if((h=gg.ply)!=null){if(typeof h.steps==="function"){h.steps()}}if(gg.keys[69]===1){gg.net.out.USE=1}if(gg.minimap!=null){gg.minimap.chase()}l=this.actives;for(e=0,r=l.length;e<r;e++){t=l[e];g=t.visuals;for(i=0,n=g.length;i<n;i++){c=g[i];c.step()}}if(gg.net!=null){p=gg.net.visuals;for(s in p){c=p[s];c.step()}gg.net.in={}}u=gg.trails;for(o=0,a=u.length;o<a;o++){d=u[o];if(d!=null){d.step()}}return true}dtor(t){var s,e,i,r,n,a;a=this.actives;for(i=0,n=a.length;i<n;i++){s=a[i];s.disappear(t)}this.copy=[];for(e=r=0;r<=4;e=++r){this.chunks[e]=[null,null,null,null,null]}this.load=false;return true}mesheseru(){var t,s,e,i,r,n,a,o;console.log("Meshes-seru!");if(gg.ed!=null){this.meshes=[];n=this.actives;for(s=0,i=n.length;s<i;s++){t=n[s];a=t.visuals;for(e=0,r=a.length;e<r;e++){o=a[e];if(o.mesh){this.meshes.push(o.mesh)}}}}return 1}}}).call(this);(function(){gg.Chunk=class t{constructor(t,s){this.id=gg.CHUNKID++;this.x=t;this.y=s;this.hash=`${t},${s}`;this.tiles=[];this.raws=[];this.visuals=[];this.lights=[];this.group=new THREE.Group;this.group.matrixAutoUpdate=false;this.prefab=false}post(){console.log("Ch post");return 0}_preppl(t){var s;s=gg.visualFactory(t);s.chunk=this;s.build(false);this.lights.push(s);return s}addr(t){var s;this.raws.push(t);if("Light"===t.type){this._preppl(t);return}if(this.active){if(t.hide){return}s=gg.visualFactory(t);s.chunk=this;s.build(false);if(s.mesh!=null){this.group.add(s.mesh)}this.visuals.push(s);return s}return null}removev(t){this.raws.splice(this.raws.indexOf(t.raw),1);if(this.active){this.visuals.splice(this.visuals.indexOf(t),1);this.group.remove(t.mesh);t.dtor()}return 1}disappear(t=false){var s,e,i,r,n,a,o,h;gg.scene.remove(this.group);if(t){console.log("deep del ch");a=this.visuals;for(s=0,r=a.length;s<r;s++){h=a[s];h.dtor()}this.visuals=[];this.tiles=[];this.group.children.length=0;this.prefab=false}this.active=false;o=this.lights;for(e=0,n=o.length;e<n;e++){i=o[e];gg.lightmanager.checkoff(i.light)}return 1}show(t=false){var s,e,i,r,n,a,o,h,l;if(!t){this.active=true}if(!this.prefab){o=this.raws;for(s=0,r=o.length;s<r;s++){a=o[s];if(a.hide){continue}if(a.interior&&(gg.interior==null||a.interior!==gg.interior.name)){continue}l=gg.visualFactory(a);l.chunk=this;l.build(false);if(l.mesh!=null){this.group.add(l.mesh)}this.visuals.push(l)}this.prefab=true}if(!t){gg.scene.add(this.group)}if(!t){h=this.lights;for(e=0,n=h.length;e<n;e++){i=h[e];gg.lightmanager.register(i.light)}}return 1}}}).call(this);(function(){gg.makepan=function(){var t;t={value:0,period:0};this.pan=(()=>{t.period+=.012*this.timestep;if(t.period>Math.PI*2){t.period-=Math.PI*2}t.value=2e-4*Math.cos(t.period);this.camera.rotation.z+=t.value;return 0});return this.pan};gg.music=function(){var t,s,e,i;t=gg.sounds.music;if(Array.isArray(t)){i=t[Math.floor(Math.random()*t.length)]}e=gg.audio[i];if(!(e instanceof AudioBuffer)){return}s=new THREE.Audio(gg.listener);s.setBuffer(e);s.autoplay=true;s.setVolume(.3);return s.play()};gg.letterbox=function(t){var s,e,i,r;console.log("gg.letterbox");gg.zoom=220;if(t){s=$("<div>");s.attr("id","letterbox");r=$("<div>");r.attr("class","up");s.append(r);e=$("<div>");e.attr("class","down");s.append(e);i=$("<div>");i.attr("class","text");i.text(t);e.append(i);$("#overlay").append(s);setTimeout(function(){gg.letterbox(false);return 1},7e3)}else{$("#letterbox").remove();gg.zoom=gg.C.ZOOM.PED}return 1}}).call(this);(function(){var t;t=[];gg.Net=class t{constructor(){this.visuals=[];this.ws=null;this.open=false;this.frame=-1;this.in={};this.out={};this.last={x:0,y:0,r:0,z:0};this.connect()}connect(){var t;t=this;this.ws=new WebSocket(gg.config.ws);this.ws.onopen=function(){t.open=true;new gg.bubble("Connected to server");t.interval=setInterval("gg.net.loop()",100);t.loop();return true};this.ws.onmessage=function(s){t.takein(JSON.parse(s.data));return true};this.ws.onclose=function(){if(t.open){new gg.bubble("Connection was closed. Reload page to try to reconnect.",true)}t.open=false;clearInterval(this.interval);return true};this.ws.onerror=function(t){new gg.bubble(" <span class=\"fail\">Can't reach server. Maybe it's down for maintenance.</span>");return gg.zoom=gg.C.ZOOM.PED};true;return true}takein(t){var s,e,i,r,n,a,o,h;if(Object.prototype.toString.call(t[0])!=="[object Array]"){this.in=t.shift()}this.fores();for(i=0,r=t.length;i<r;i++){s=t[i];o=s[0].charAt(0);e=parseInt(s[0].substr(1));if(s[1]!=null){a=s[1].type||null}n=null;n=function(){switch(o){case"z":return{id:e,type:"Zombie",states:s[1],x:s[2],y:s[3],r:s[4],z:s[5]};case"g":case"p":return{id:e,type:"Man",states:s[1],x:s[2],y:s[3],r:s[4],z:s[5]};case"c":return{id:e,type:"Car",states:s[1],x:s[2],y:s[3],r:s[4],z:s[5]};case"d":return{id:e,type:"Decal",states:s[1],x:s[2],y:s[3],r:s[4],z:s[5]};case"u":return{id:e,type:"Pickup",states:s[1],x:s[2],y:s[3],r:s[4],z:s[5]};case"m":case"n":return{id:e,type:a,states:s[1],x:s[2],y:s[3],r:s[4],z:s[5]};default:return null}}();if(this.YOURE===e&&"p"===o){n.type="Player"}n.net=true;if(n!=null&&!(h=this.visuals[s[0]])){this.visuals[s[0]]=gg.visualFactory(n)}else{h.patch(n)}}this.afts();return 1}collect(){var t,s,e,i;e=false;t=function(t){return t.toFixed(2)};s=[];if(gg.ply!=null){i=gg.ply;if(t(this.last.x)!==t(i.props.x)){s[0]=parseFloat(t(i.props.x))}if(t(this.last.y)!==t(i.props.y)){s[1]=parseFloat(t(i.props.y))}if(t(this.last.r)!==t(i.props.r)){s[2]=parseFloat(t(i.props.r))}if(t(this.last.z)!==t(i.props.z)){s[3]=parseFloat(t(i.props.z))}this.last={x:i.props.x,y:i.props.y,z:i.props.z,r:i.props.r}}if(!!Object.keys(gg.net.out).length){s[4]=gg.net.out}gg.net.out={};return s}loop(){var t,s;t=this.collect();if(t.length){s=JSON.stringify(t);this.ws.send(s)}return true}fores(t){var s,e,i,r,n,a,o,h,l,g,p,u,d,c;if(this.in.removes){l=this.in.removes;for(e=0,i=l.length;e<i;e++){t=l[e];if((c=this.visuals[t])==null){continue}c.dtor();delete this.visuals[t]}}if(this.in.bubbles){g=this.in.bubbles;for(o=0,r=g.length;o<r;o++){a=g[o];new gg.bubble(a)}}if(this.in.quest){p=this.in.bubbles;for(h=0,n=p.length;h<n;h++){a=p[h];new gg.bubble(a)}}if(this.in.inventory){gg.inventory.patch(this.in.inventory)}if(this.in.YOURE){this.YOURE=this.in.YOURE}if(this.in.INTR!=null){console.log(`intr ${this.in.INTR}`);gg.ambient=6911606;gg.zoom=gg.C.ZOOM.INTR;gg.interior=new gg.Interior(this.in.INTR,this.in.INTRSTYLE);gg.map.dtor(true);u=this.visuals;for(s in u){c=u[s];c.dtor()}this.visuals=[]}if(this.in.OUTR!=null){gg.ambient=gg.outside;gg.zoom=gg.melee?gg.C.ZOOM.MELEE:gg.gun?gg.C.ZOOM.GUN:gg.C.ZOOM.PED;gg.map.dtor(true);this.recolor();gg.interior.dtor();gg.interior=null;d=this.visuals;for(s in d){c=d[s];c.dtor()}this.visuals=[]}return 1}recolor(){var t,s,e,i;e=gg.materials;for(s in e){i=e[s];if(!!~s.indexOf("Interior")){continue}t=gg.ambient;if(!!~s.indexOf("Sloped")){t=gg.darker(null)}i.color=new THREE.Color(t)}return 1}afts(){var t,s,e,i,r,n,a,o,h;if(this.in.TP!=null&&gg.ply!=null){gg.ply.props.x=this.in.TP[0];gg.ply.props.y=this.in.TP[1];if(this.in.TP[2]!=null){gg.ply.props.z=this.in.TP[2]}gg.ply.embody();console.log("in.TP")}if(this.in.SEL!=null){gg.inventory.sel=this.in.SEL}if(gg.ply!=null&&this.in.h!=null){console.log("were hit");gg.play(gg.sounds.kungfu[0],gg.ply)}if(gg.ply!=null&&this.in.DEAD){gg.ply.die();gg.inventory.patch({})}if(this.in.CARDS){o=this.in.CARDS;for(e=0,i=o.length;e<i;e++){n=o[e];t=$(`<div class="card" data-id="${n.id}">`);t.data("id",n.id);t.data("name",n.name);t.append(`<img src="play/sty/nontile/pickups/${n.name}.png"></img>`);t.click(function(){var t;t=$(this);t.addClass("take");gg.net.out.CARD=t.data("id");setTimeout(function(){return t.remove()},700)})}$("#pickups").append(t)}if(this.in.RMCARDS){h=this.in.RMCARDS;for(a=0,r=h.length;a<r;a++){s=h[a];console.log(`removing ${s}`);$(`.card[data-id="${s}"]`).remove()}}if(this.in.TARGET!=null){gg.arrow.material.visible=true;gg.arrow.pointat(this.in.TARGET)}if(this.in.NOTARGET!=null){gg.arrow.material.visible=false}if(this.in.YOURE){gg.onspawn()}if(this.in.LINE&&gg.ply!=null){new gg.Trail({x:gg.ply.props.x,y:gg.ply.props.y,to:this.in.LINE})}return 1}}}).call(this);(function(){gg.Sprite=function(){class t extends gg.Visual{constructor(t,s){super(t);this.sprite=s;this.type="Sprite";this.sty=gg.loadSty(this.sprite.path);if(this.sprite.scale==null){this.sprite.scale=1}this.keyframe=[1,3,3,7];gg.Sprite.prototype.patch.call(this,t);this.last=gg.delta;this.tile=":o";this.on=null;this.pixie()}dtor(){gg.scene.remove(this.mesh);if(this.shadow!=null){gg.scene.remove(this.shadow)}this.shadow=null;super.dtor();return 12}state(t){this.props.states=t;return 1}build(t){super.build(t);if(this.shadow!=null){gg.scene.add(this.shadow)}return 1}pixie(){var t;this.material=gg.material(this.sprite.path,this,this.sprite.salt);this.geometry=new THREE.PlaneBufferGeometry(this.sprite.sprite.width*this.sprite.scale,this.sprite.sprite.height*this.sprite.scale,1);this.geometry.addAttribute("uv2",new THREE.BufferAttribute(this.geometry.attributes.uv.array,2));this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.castShadow=false;this.mesh.receiveShadow=false;this.mesh.ggsolid=this;if(!this.sprite.hasShadow){return}t=new THREE.MeshBasicMaterial({map:this.sty,color:0,opacity:.25,transparent:true});this.shadow=new THREE.Mesh(this.geometry,t);return 1}pose(){this.mesh.position.set(this.props.x,this.props.y,this.props.z+this.sprite.elevation);this.mesh.rotation.z=this.props.r;if(!(this.sprite.hasShadow&&this.shadow!=null)){return}this.shadow.position.set(this.props.x+3,this.props.y+-3,this.props.z+1);this.shadow.rotation.z=this.props.r;return 1}frame(t,s,e){var i,r,n,a;i=this.sprite.x/this.sprite.sheet.width||0;a=i+1/(this.sprite.sheet.width/this.sprite.sprite.width)*t;s=s;n=1/(this.sprite.sheet.width/this.sprite.sprite.width);r=this.sprite.sprite.height/this.sprite.sheet.height;gg.posplane(e||this.geometry,0,a,s,n,r);return[a,s,n,r]}patch(t){var s;if(t.r!=null&&this.understeer){t.r=gg.normalize(t.r)}if(t.x!=null){this.keyframe[0]=t.x}if(t.y!=null){this.keyframe[1]=t.y}if(t.r!=null){this.keyframe[2]=t.r}this.curs=[this.props.x,this.props.y,this.props.r,this.props.z];if(t.r!=null&&this.understeer){s=t.r-this.props.r;if(s<-Math.PI){this.curs[2]=-(s+gg.C.PII)}else if(s>Math.PI){this.curs[2]=gg.C.PII+gg.C.PII-s}}this.last=0;return 1}tween(){var t,s;this.adds=[0,0,0,0];for(t=s=0;s<=3;t=++s){this.adds[t]=(this.keyframe[t]-this.curs[t])*.1}this.props.x+=this.adds[0];this.props.y+=this.adds[1];this.props.r+=this.adds[2];if(this.understeer){if(this.props.r>gg.C.PII){this.props.r=this.props.r-gg.C.PII}else if(this.props.r<0){this.props.r=gg.C.PII-this.props.r}}return true}step(){this.zaware();this.raise();if(!this.props.net){return}this.last+=gg.delta;if(this.last>.1){this.patch({x:this.keyframe[0],y:this.keyframe[1],r:this.keyframe[2],z:this.keyframe[3]})}this.tween();return 1}zaware(){var t,s,e,i,r,n,a,o;r=`${Math.floor(this.props.x/64)},${Math.floor(this.props.y/64)}`;if(r===this.tile){return}this.tile=r;o=`${Math.floor(this.props.x/gg.C.CHUNITS)},${Math.floor(this.props.y/gg.C.CHUNITS)}`;this.at=gg.map.offChunks[o];if(!((i=this.at)!=null?i.active:void 0)){return}n=this.at.tiles[this.tile];if(!(n!=null&&Array.isArray(n))){return}t=n[0];for(s=0,e=n.length;s<e;s++){a=n[s];if(Math.abs(this.props.z-a.raise.mean)<Math.abs(this.props.z-t.raise.mean)){t=a}}this.on=t;return 0}raise(){var t,s,e;if(this.on==null){return}if(this.on.props.s==null){this.props.z=this.on.raise.mean;return}gg.Sprite.prototype.raycaster.ray.origin.copy(new THREE.Vector3(this.props.x,this.props.y,this.props.z+5));t=gg.Sprite.prototype.raycaster.intersectObject(this.on.mesh);this.props.z=((s=t[0])!=null?(e=s.point)!=null?e.z:void 0:void 0)+1||this.on.raise.mean;return 1}}t.prototype.raycaster=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3(0,0,-1));return t}.call(this);gg.SpriteClone=class t extends gg.Visual{constructor(t,s,e=null){super(t);this.sprite=s;this.parent=e;if(this.parent==null){console.warn("Bad Parenting")}this.type="Sprite Clone";this.fairy()}dtor(){gg.scene.remove(this.mesh);super.dtor();return 1}fairy(){this.material=gg.material(this.sprite.path,this,this.sprite.salt);this.mesh=new THREE.Mesh(this.parent.geometry,this.material);return 1}pose(){this.mesh.position.set(this.parent.props.x,this.parent.props.y,this.parent.props.z+this.parent.sprite.elevation);this.mesh.rotation.z=this.parent.props.r;return 1}step(){return 1}}}).call(this);(function(){gg.Entity=function(){class t extends gg.Visual{constructor(t){super(t);this.type="Entity";this.cyan=false;this.grid=false;this.size=24}dtor(){if(this.mesh){gg.scene.remove(this.mesh)}return super.dtor()}step(){return true}hah(){return true}cube(){if(this.cyan){return false}this.cyan=true;this.material=new THREE.MeshLambertMaterial({map:gg.loadSty("special/ent.png"),transparent:true,opacity:.5,color:this.constructor.color});this.geometry=new THREE.BoxGeometry(this.size,this.size,this.size,1,1,1);this.mesh=new THREE.Mesh(this.geometry,this.material);if(this.grid){this.mesh.position.x=this.props.x*64+36;this.mesh.position.y=this.props.y*64+36;this.mesh.position.z=this.props.z*64+32}else{this.mesh.position.x=this.props.x;this.mesh.position.y=this.props.y;this.mesh.position.z=this.props.z}this.mesh.ggsolid=this;gg.map.meshes.push(this.mesh);gg.scene.add(this.mesh);return true}}t.color=16777215;return t}.call(this);gg.Walk=function(){class t extends gg.Entity{constructor(t){super(t);this.type="Walk";this.cached=null;this.lines=[];this.size=14;gg.walks[this.vjson.id]=this;this}step(){var t,s,e,i,r,n,a,o,h,l,g,p;if(gg.ed==null){return}if(this.cached===this.props.vjson){return}this.cached=this.props.vjson;l=this.lines;for(e=0,n=l.length;e<n;e++){r=l[e];gg.scene.remove(r)}this.lines=[];if(this.vjson.links==null){return}g=this.vjson.links;for(i=0,a=g.length;i<a;i++){s=g[i];p=gg.walks[s];if(p==null){continue}h=this.red;t=new THREE.Geometry;t.vertices.push(new THREE.Vector3(this.props.x,this.props.y,this.props.z));t.vertices.push(new THREE.Vector3(p.props.x,p.props.y,p.props.z));o=new THREE.Line(t,h);this.lines.push(o);gg.scene.add(o)}return true}dtor(){var t,s,e,i;i=this.lines;for(t=0,e=i.length;t<e;t++){s=i[t];gg.scene.remove(s)}return super.dtor()}hah(){return true}}t.color=6356866;t.prototype.red=new THREE.LineBasicMaterial({color:13369344,transparent:true,opacity:.5});t.prototype.blue=new THREE.LineBasicMaterial({color:255,transparent:true,opacity:.5});return t}.call(this);gg.Drive=function(){class t extends gg.Entity{constructor(t){super(t);this.type="Drive";this.cached=null;this.lines=[];this.size=18;gg.drives[this.vjson.id]=this;this}step(){var t,s,e,i,r,n,a,o,h,l,g,p;if(gg.ed==null){return}if(this.cached===this.props.vjson){return}this.cached=this.props.vjson;l=this.lines;for(e=0,n=l.length;e<n;e++){r=l[e];gg.scene.remove(r)}this.lines=[];if(this.vjson.links==null){return}g=this.vjson.links;for(i=0,a=g.length;i<a;i++){s=g[i];p=gg.drives[s];if(p==null){continue}h=this.blue;t=new THREE.Geometry;t.vertices.push(new THREE.Vector3(this.props.x,this.props.y,this.props.z));t.vertices.push(new THREE.Vector3(p.props.x,p.props.y,p.props.z));o=new THREE.Line(t,h);this.lines.push(o);gg.scene.add(o)}return true}dtor(){var t,s,e,i;i=this.lines;for(t=0,e=i.length;t<e;t++){s=i[t];gg.scene.remove(s)}return super.dtor()}hah(){return true}}t.color=2301906;t.prototype.blue=new THREE.LineBasicMaterial({color:16711680,transparent:true,opacity:.5});return t}.call(this);gg.ParkingSpace=function(){class t extends gg.Entity{constructor(t){super(t);this.type="Parking space";this.grid=false}step(){return 1}hah(){return 1}}t.color=9852927;return t}.call(this);gg.SafeZone=function(){class t extends gg.Entity{constructor(t){super(t);this.type="Safe Zone";this.size=30}step(){return 1}}t.color=16736367;return t}.call(this);gg.Arrow=class t{constructor(){this.show=false;this.target={x:0,y:0};this.material=new THREE.MeshLambertMaterial({map:gg.loadSty("nontile/arrow.png"),transparent:true,opacity:0,side:THREE.FrontSide,visible:false});this.geometry=new THREE.PlaneBufferGeometry(19/2,27/2,1);this.mesh=new THREE.Mesh(this.geometry,this.material);gg.scene.add(this.mesh)}stick(){var t,s,e,i;if(!this.material.visible){return}e=this.target.x-gg.camera.position.x;i=this.target.y-gg.camera.position.y;s=Math.hypot(e,i);t=Math.atan2(i,e);e=Math.cos(t)*48;i=Math.sin(t)*48;if(s<48){this.material.opacity=0}else{this.material.opacity=1}this.mesh.position.set(gg.camera.position.x+e,gg.camera.position.y+i,64.05);this.mesh.rotation.z=t-Math.PI/2;return true}pointat(t){this.target.x=t.x;this.target.y=t.y;return true}}}).call(this);(function(){gg.Decal=class t extends gg.Sprite{constructor(t){var s,e;s=t.states?t.states.decal:t.decal;s=gg.decals[s]||gg.decals.err;if(s.scale==null){s.scale=1}if(s.hasShadow==null){s.hasShadow=false}if(s.normal==null){s.normal=false}e={elevation:.05,path:s.sty,normal:s.normal,hasShadow:!!s.hasShadow,x:s.x||0,sprite:{width:s.sprite.width,height:s.sprite.height},sheet:{width:s.sheet.width,height:s.sheet.height},scale:s.scale};super(t,e);this.understeer=false;this.build();this.type="Decal";this.mesh.ggsolid=this;this.frame(s.frame||0,s.y);if(t.states!=null&&t.states.spin){this.embody();this.dynamicBody.SetAngularVelocity(t.states.spin)}this.pose()}embody(){this.bodyDef=new box2d.b2BodyDef;this.bodyDef.type=box2d.b2BodyType.b2_dynamicBody;this.bodyDef.allowSleep=false;this.circleShape=new box2d.b2CircleShape(1/gg.scaling);this.fixtureDef=new box2d.b2FixtureDef;this.fixtureDef.shape=this.circleShape;this.fixtureDef.density=1;this.fixtureDef.filter.categoryBits=gg.masks.casings;this.fixtureDef.filter.maskBits=gg.masks.solid|gg.masks.casings;this.bodyDef.position.Set(this.props.x/gg.scaling,this.props.y/gg.scaling);this.dynamicBody=gg.world.CreateBody(this.bodyDef);this.dynamicBody.SetTransform(this.dynamicBody.GetPosition(),this.props.r);this.dynamicBody.CreateFixture(this.fixtureDef);this.dynamicBody.SetLinearDamping(.5);this.dynamicBody.SetAngularDamping(2.5);return true}dtor(){if(this.dynamicBody!=null){gg.world.DestroyBody(this.dynamicBody)}this.mesh.ggsolid=null;super.dtor();return true}step(){var t;if(this.dynamicBody!=null){t=this.dynamicBody.GetPosition();this.props.x=t.x*gg.scaling;this.props.y=t.y*gg.scaling;this.props.r=this.dynamicBody.GetAngle();this.pose()}return true}};gg.Tree=class t extends gg.Sprite{constructor(t){var s;if(t.actualx!=null){t.x=t.actualx}if(t.actualy!=null){t.y=t.actualy}s={elevation:64,path:"nontile/tree.png",normal:false,hasShadow:true,sprite:{width:64,height:64},sheet:{width:64,height:64},scale:1};super(t,s);this.understeer=false;gg.tree=this;this.type="Tree";this.mesh.ggsolid=this;this.pose()}step(){return false}};gg.decals={err:{sty:"nontile/casings.png",sprite:{width:8,height:8},sheet:{width:32,height:32},y:.75,frame:0,scale:.37},b0:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.75,frame:0,normal:true},b1:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.75,frame:1,normal:true},b2:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.75,frame:2,normal:true},b3:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.75,frame:3,normal:true},b4:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.5,frame:0,normal:true},b5:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.5,frame:1,normal:true},b6:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.5,frame:2,normal:true},b7:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.5,frame:3,normal:true},g0:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.25,frame:0,normal:true},g1:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.25,frame:1,normal:true},g2:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.25,frame:2,normal:true},g3:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:.25,frame:3,normal:true},g4:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:0,frame:0,normal:true},g5:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:0,frame:1,normal:true},g6:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:0,frame:2,normal:true},g7:{sty:"nontile/bloods.png",sprite:{width:32,height:32},sheet:{width:128,height:128},y:0,frame:3,normal:true},c1:{sty:"nontile/casings.png",sprite:{width:8,height:8},sheet:{width:32,height:32},y:.75,frame:0,scale:.37},c2:{sty:"nontile/casings.png",sprite:{width:8,height:8},sheet:{width:32,height:32},y:.75,frame:1,scale:.4},c3:{sty:"nontile/casings.png",sprite:{width:8,height:8},sheet:{width:32,height:32},y:.75,frame:2,scale:.4},c4:{sty:"nontile/casings.png",sprite:{width:8,height:8},sheet:{width:32,height:32},y:.75,frame:3,scale:.4},c5:{sty:"nontile/casings.png",sprite:{width:8,height:8},sheet:{width:32,height:32},y:.5,frame:0,scale:.4},scrub1:{sty:"nontile/scrubs.png",sprite:{width:16,height:16},sheet:{width:64,height:64},y:.75,frame:0,hasShadow:false},scrub2:{sty:"nontile/scrubs.png",sprite:{width:32,height:32},sheet:{width:64,height:64},x:16,y:.5,frame:0,hasShadow:false}}}).call(this);(function(){gg.Man=function(){class t extends gg.Sprite{constructor(t){var s,e,i,r;i=667/29;s=1/i;e=.11;r={elevation:3,path:"nontile/man/template.png",normalPath:"nontile/man/normal.png",normal:true,hasShadow:true,sprite:{width:29,height:29},sheet:{width:261,height:667}};super(t,r);this.other={frames:8,moment:.08,y:s*--i};this.walk={frames:8,moment:e,y:s*--i};this.run={frames:8,moment:.08,y:s*--i};this.punch={frames:8,moment:e,y:s*--i};this.walkpunch={frames:8,moment:e,y:s*--i};this.runpunch={frames:8,moment:.08,y:s*--i};this.slash={frames:8,moment:e,y:s*--i,inverse:true,start:3};this.walkslash={frames:8,moment:e,y:s*--i,inverse:true,start:3};this.runslash={frames:8,moment:.08,y:s*--i,inverse:true,start:3};this.walkgun={frames:8,moment:e,y:s*--i};this.rungun={frames:8,moment:.08,y:s*--i};this.walkrifle={frames:8,moment:e,y:s*--i};this.runrifle={frames:8,moment:.08,y:s*--i};this.falls={y:s*--i};this.scratch={frames:8,moment:.14,y:s*--i};this.jump={frames:8,moment:e,y:s*--i};this.door={frames:8,moment:.14,y:s*--i};this.sit={frames:5,moment:e,y:s*--i};this.drop={frames:8,moment:e,y:s*--i};this.trip1={frames:9,moment:e,y:s*--i};this.trip2={frames:8,moment:e,y:s*--i};this.drown={frames:8,moment:e,y:s*--i};this.cardoor={frames:8,moment:.13,y:s*--i,start:2};this.understeer=true;this.type="Man";this.build();this.car=null;this.dead=false;this.freeze=false;this._MAN={freeze:false,moving:false,turning:false,_cd:null,_yc:null,car:null,using:null,strafing:false,gallop:false,holding:false,recoiling:0,opening:false,sitting:false,scratching:false};this.parts=[];gg.clonemanmaterial(this);this.shadow.material=gg.Man.prototype.shadow;this.state(t,true);this.embody();this.grubble()}dtor(){if(this.dynamicBody){gg.world.DestroyBody(this.dynamicBody)}super.dtor();return 1}embody(){this.bodyDef=new box2d.b2BodyDef;this.bodyDef.type=box2d.b2BodyType.b2_dynamicBody;this.bodyDef.allowSleep=false;this.circleShape=new box2d.b2CircleShape(4.1/gg.scaling);this.fixtureDef=new box2d.b2FixtureDef;this.fixtureDef.shape=this.circleShape;this.fixtureDef.density=1;this.fixtureDef.filter.categoryBits=gg.masks.organic;this.fixtureDef.filter.maskBits=gg.masks.solid|gg.masks.organic;this.bodyDef.position.Set(this.props.x/gg.scaling,this.props.y/gg.scaling);this.dynamicBody=gg.world.CreateBody(this.bodyDef);this.dynamicBody.SetTransform(this.dynamicBody.GetPosition(),this.props.r);this.fixture=this.dynamicBody.CreateFixture(this.fixtureDef);return true}present(t){if(t==null){t=true}this.mesh.visible=t;this.shadow.visible=t;this.frame(0,this.other.y);return 1}dressup(t){var s,e,i,r,n,a;if(t===this.oldoutfit){return}if(this===gg.ply){console.log(t)}s=JSON.parse(JSON.stringify(this.sprite));s.hasShadow=false;r=t||((n=this.props.states)!=null?n.o:void 0)||"susnjepoph";for(e=i=0;i<=4;e=++i){a=gg.Man.prototype.parts[r.substring(e*2,e*2+2)];this.parts.push(`nontile/man/${a}.png`)}this.parts.push("nontile/man/empty.png");this.skin=this.parts[0];this.feet=this.parts[1];this.legs=this.parts[2];this.body=this.parts[3];this.hair=this.parts[4];this.gun=this.parts[5];this.material.uniforms.skin.value=gg.loadSty(this.skin);this.material.uniforms.feet.value=gg.loadSty(this.feet);this.material.uniforms.legs.value=gg.loadSty(this.legs);this.material.uniforms.body.value=gg.loadSty(this.body);this.material.uniforms.hair.value=gg.loadSty(this.hair);this.material.uniforms.gun.value=gg.loadSty(this.gun);this.oldoutfit=r;return 1}patch(t){super.patch(t);this.state(t);return true}frame(t,s,e){var i;i=super.frame(t,s,e);return 1}pose(){super.pose();return 1}step(){super.step();if(this.dead){this.pose();return}if(this.props.net){if(this.r>=gg.C.PII){this.r=this.r-gg.C.PII}else if(this.r<=0){this.r=gg.C.PII-this.r}if(this.dynamicBody!=null){this.dynamicBody.SetPosition(new box2d.b2Vec2(this.props.x/gg.scaling,this.props.y/gg.scaling));this.dynamicBody.SetTransform(this.dynamicBody.GetPosition(),this.props.r);this.dynamicBody.SetAngularVelocity(0);this.dynamicBody.SetLinearVelocity(new box2d.b2Vec2(0,0))}this._MAN.moving=Math.abs(this.adds[0])>.08||Math.abs(this.adds[1])>.08}this.animate();this.pose();return 1}state(t,s=false){var e,i,r,n;if(t.states==null){return}e=t.states;if(e.o!=null){this.dressup(e.o)}if(e.scratch!=null){console.log("scratch head");this._MAN.scratching=true;gg.anim.call(this.scratch,true)}if(e.yc!=null){i=gg.net.visuals[e.yc.i];this._MAN._yc=e.yc;this._MAN.car=i||null;this._MAN.opening=true;this.freeze=true;console.log("yc your car",e.yc)}if(e.cd!=null){this._MAN._cd=e.cd}if(e.w!=null){n=1===e.w;r=2===e.w;this._MAN.gallop=r;this._MAN.moving=n||r}if(e.u!=null){this._MAN.using=e.u;this.hold(gg.weps[this._MAN.using]||null)}if(e.r!=null){console.log("r");gg.play(gg.sounds.kungfu[2],this)}if(e.d!=null){this.dead=true;this.frame(4,this.falls.y);this.sprite.elevation=1;this.shadow.visible=false;if(this.dynamicBody!=null){gg.world.DestroyBody(this.dynamicBody)}this.dynamicBody=null;if(!s){gg.play(gg.sounds.screams[e.d],this)}}if(e.h!=null){console.log("hit");gg.play(gg.sounds.kungfu[e.h],this)}if(e.g!=null){this._MAN.recoiling=1;gg.anim.call(this.other,true);gg.play(gg.sounds[this._MAN.using],this,100)}if(e.s!=null){console.log("slash");this._MAN.slashing=1;gg.anim.call(this.slash,true);gg.anim.call(this.walkslash,true);gg.anim.call(this.runslash,true)}if(e.a!=null&&e.d==null){gg.play(gg.sounds.hesgotagun[e.a],this)}if(e.fall!=null){this.floored=e.fall;this.sprite.elevation=1;this.shadow.visible=false;if(this.dynamicBody!=null){gg.world.DestroyBody(this.dynamicBody)}this.dynamicBody=null}if(e.up!=null){this.eating=false;this.swinging=false;this.recoil=false;this.floored=null;this.falls.i=0;this.sprite.elevation=2;this.shadow.visible=true;this.embody()}return 1}hold(t){if(t!=null){this._MAN.holding=function(){switch(t.type){case"SMG":case"Carbine":case"Shotgun":case"AR":case"DMR":case"Sniper":return"RIFLE";case"Handgun":return"GUN"}}();this.gun=`nontile/man/${t.type.toLowerCase()}.png`}else{this.gun="empty.png";this._MAN.holding=false}this.material.uniforms.gun.value=gg.loadSty(this.gun);return 1}animate(){var t,s,e,i,r,n,a,o,h,l,g,p,u;if(this.dead){return"freeze"}o=0;s=null;if(this.floored!=null){this.frame(this.floored,this.falls.y);return}if(this._MAN.opening){i=(l=this._MAN.car)!=null?l.model.props.doors[this._MAN._cd.i||0]:void 0;this.sprite.elevation=3;a=this._MAN._yc.f;o=0;s=this.door;gg.anim.call(s);o=s.i;if(s.i===0){n=this.fixture.GetFilterData();n.categoryBits=gg.masks.none;n.maskBits=gg.masks.none;this.fixture.SetFilterData(n);if(this._MAN.car!=null){this.props.r=this._MAN.car.props.r}}if(s.i===4){o=3;gg.anim.call(this.sit,true);gg.anim.call(this.door,true);gg.anim.call(this.cardoor,true);this._MAN.opening=false;this._MAN.sitting=true;this._MAN.sat=false}e=this._MAN.car;r=Math.abs(s.i-4);if(r!==0){if(e!=null){e.dooring(this._MAN._cd.i,r)}}if(this._MAN.opening&&this._MAN.opening!==2){gg.play(gg.sounds.cardoor[0],this);this._MAN.opening=2}}else if(this._MAN.sitting){a=this._MAN._yc.f;this.sprite.elevation=1;o=0;s=this.sit;gg.anim.call(s);o=s.i;p=this._MAN._cd.xx-this.props.x;u=this._MAN._cd.yy-this.props.y;h=Math.hypot(p,u);t=Math.atan2(u,p);this.props.x+=Math.cos(t)*h/s.frames/4;this.props.y+=Math.sin(t)*h/s.frames/4;e=this._MAN.car||this.car;gg.anim.call(this.cardoor);if(e!=null){e.dooring(this._MAN._cd.i,this.cardoor.i)}if(this.cardoor.i===5&&this._MAN.sitting&&this._MAN.sitting!==2){gg.play(gg.sounds.cardoor[1],this);this._MAN.sitting=2}if(this.cardoor.i===5){this.present(false);this.car=this._MAN.car;this.freeze=false;this._MAN.sitting=false;if(this===gg.ply){gg.net.out.BLEH=1}if((g=this.car)!=null){g.enter(this)}this._MAN.car=null}}else if(this._MAN.slashing){o=0;s=this.slash;if(!this._MAN.gallop&&this._MAN.moving){s=this.walkslash}if(this._MAN.gallop&&this._MAN.moving&&!this.aim){s=this.runslash}gg.anim.call(s);o=s.i;if(s.done){this._MAN.slashing=false;gg.anim.call(s,true);this.walk.i=4;this.run.i=4;s=null}else{this.slash.i=s.i;this.slash.timer=s.timer;this.walkslash.i=s.i;this.walkslash.timer=s.timer;this.runslash.i=s.i;this.runslash.timer=s.timer}}else if(this._MAN.scratching){if(this._MAN.moving){s=null;gg.anim.call(this.scratch)}else{s=this.scratch;gg.anim.call(s,false);o=s.i;if(s.done){s=null;this._MAN.scratching=false;gg.anim.call(this.scratch,true)}}}if(s==null){s=this.other;o=0;if(this._MAN.moving){this._MAN.scratching=false;if(this._MAN.holding==="GUN"){s=this._MAN.gallop?this.rungun:this.walkgun}else if(this._MAN.holding==="RIFLE"){s=this._MAN.gallop?this.runrifle:this.walkrifle}else{s=this._MAN.gallop?this.run:this.walk}gg.anim.call(s);o=s.i}else if(this._MAN.holding==="GUN"){o=1}else if(this._MAN.holding==="RIFLE"){o=4}if(!this._MAN.moving){gg.anim.call(this.walk,true);gg.anim.call(this.run,true);if(this._MAN.recoiling){gg.anim.call(this.other);if(s.i===2){this._MAN.recoiling=0}else{o+=1+s.i}}else{gg.anim.call(this.other,true)}}}this.frame(o,s.y);if(a){gg.flipplane(this.geometry,0)}return 0}grubble(){return 1}}t.prototype.shadow=new THREE.MeshPhongMaterial({alphaMap:gg.loadSty("nontile/man/alphamap.png"),aoMap:gg.loadSty("nontile/man/aomap.png"),color:0,opacity:.2,transparent:true});t.prototype.parts={wh:"white",zo:"zombie",ph:"ponchohood",gl:"gloves",le:"leather",su:"surgical",bl:"black",br:"brown",ba:"bald",Bl:"blackhair",lo:"loafers",sn:"sneakers",al:"allstars",dr:"dress",je:"jeans",de:"denim",kh:"khaki",po:"poncho",sw:"sweater",bo:"bomber",pa:"parka",co:"commando",sh:"shirt",hg:"handgun",sm:"smg",cb:"carbine",ar:"ar",sg:"shotgun",dm:"dmr",sp:"sniper"};return t}.call(this)}).call(this);(function(){gg.Player=class t extends gg.Man{constructor(t){super(t);this.type="Player";gg.ply=this;t.net=false;this.lastSound=null;this.lastStep=0;this.footy=false;this.LASTW=this._MAN.gallop;this.oldish={x:t.x,y:t.y,z:t.z,r:0}}dtor(){if(this===gg.ply){gg.ply=null}super.dtor();return 1}embody(){if(this.dynamicBody!=null){gg.world.DestroyBody(this.dynamicBody);this.dynamicBody=null}super.embody();this.dynamicBody.SetLinearDamping(15);this.dynamicBody.SetAngularDamping(3);return 1}patch(t){this.state(t);return 1}state(t,s=false){var e,i;if(t.states==null){return}super.state(t,s);if(t.states.g!=null){e=gg.weps[this._MAN.using]||null;if(!e){return}i=function(){switch(e.type){case"Handgun":return 2;case"SMG":return 2;case"Carbine":return 3;case"Shotgun":return 5;case"AR":return 4;case"DMR":return 5;case"Sniper":return 6}}();gg.quake=i}return 1}die(){gg.zoom=gg.C.ZOOM.DEAD;this.dead=true;this.shadow.visible=false;this.sprite.elevation=1;gg.play(gg.sounds.screams[Math.floor(Math.random()*4)],this);this.frame(4,this.falls.y);return 1}step(){super.step();return 0}steps(){var t,s,e,i,r,n,a,o,h,l,g,p,u,d,c,m,f,y,v,b;if(this.dead){this.pose();return}if(this.car!=null||this.dynamicBody==null){return}r=gg.keys[65];o=gg.keys[68];y=gg.keys[87];c=gg.keys[83];t=r&&!o;e=c&&!y;i=y&&!c;s=o&&!r;if(gg.aim){n=true;p=gg.mouse2d;m=Math.atan2(this.props.x-p.x,this.props.y-p.y);u=m;if(u<0){u+=Math.PI*2}u=-u;if(!this.freeze){this.props.r=u}gg.ply.dynamicBody.SetTransform(gg.ply.dynamicBody.GetPosition(),u)}if(gg.keys[16]===1){this._MAN.gallop=!this._MAN.gallop;this.LASTW=this._MAN.gallop?2:1;if(gg.net!=null){gg.net.out.W=this.LASTW}}this.dynamicBody.SetAngularVelocity(0);if(!this.freeze){p=this.dynamicBody.GetPosition();this.props.x=p.x*gg.scaling;this.props.y=p.y*gg.scaling;this.props.r=this.dynamicBody.GetAngle()}this._MAN.moving=i||e;this._MAN.turning=t||s;if(n){if(this._MAN.moving||this._MAN.turning){this._MAN.moving=true}if(this.LASTW!==1){this.LASTW=1;if((d=gg.net)!=null){d.out.W=1}}}if(n&&(r||o||y||c)){h=40;h*=gg.delta;h*=20;a=0;if(t&&i){a=Math.PI*.75}else if(s&&i){a=Math.PI*.25}else if(t&&e){a=Math.PI*1.25}else if(s&&e){a=Math.PI*1.75}else if(t){a=Math.PI*1}else if(e){a=Math.PI*1.5}else if(i){a=Math.PI*.5}else if(s){a=0}else{g=true}if(!g){v=h*Math.cos(a);b=h*Math.sin(a);f=new box2d.b2Vec2(v,b);this.dynamicBody.ApplyForce(f,this.dynamicBody.GetWorldCenter())}}if(this._MAN.turning&&!n){u=0;if(t&&!s){u=.1}if(s&&!t){u=-.1}this.dynamicBody.SetTransform(this.dynamicBody.GetPosition(),this.props.r+u)}if(this._MAN.moving&&!n){l=[40,-20];h=0;h=i?l[0]:l[1];h*=gg.delta;h*=this._MAN.gallop?40:20;a=this.props.r-Math.PI/2;v=h*Math.cos(a);b=h*Math.sin(a);f=new box2d.b2Vec2(v,b);this.dynamicBody.ApplyForce(f,this.dynamicBody.GetWorldCenter())}if(gg.net!=null&&gg.keys[32]){gg.net.out.T=1}return 1}}}).call(this);(function(){var t;gg.Car=class s extends gg.Sprite{constructor(t){var s,e,i,r,n;if(!(i=gg.Cars.TYPES[t.states.m])){console.error(`bad car model \`${t.states.m}\``)}e=t.states.c||false;s=e?`_${e}`:"";r=`nontile/cars/${i.props.sty}${s}.png`;gg.loadSty(`${r.split(".png")[0]}_deltas.png`);n={elevation:2,path:r,normalPath:`nontile/cars/${i.props.sty}normal.png`,normal:true,hasShadow:true,sprite:{width:i.props.width,height:i.props.height}};super(t,n);this.path=r;this.deltas={};this.phys={push:.1,spring:0,slip:0,slipness:0,stiff:0,lastr:t.r};this.engineon=false;this.readytime=0;this.lastSound=null;this.lastb=false;this.color=e;this.driver=false;this.model=i;this.__car={headlights:false,taillights:false};this.build();this.type="Car";this.tune=null;this.carengine=null;this.embody();gg.clonecarmaterial(this)}dtor(){var s,e,i,r;if(gg.settings.fancyHeadlights){gg.scene.remove(this.headlights)}if((s=this.deltas[t.tail_light_left.nr])!=null){s.dtor()}if((e=this.deltas[t.tail_light_right.nr])!=null){e.dtor()}if((i=this.deltas[t.head_light_left.nr])!=null){i.dtor()}if((r=this.deltas[t.head_light_right.nr])!=null){r.dtor()}if(this.dynamicBody!=null){gg.world.DestroyBody(this.dynamicBody)}super.dtor();return 1}embody(){if(this.dynamicBody!=null){gg.world.DestroyBody(this.dynamicBody)}this.bodyDef=new box2d.b2BodyDef;if(this.driver){this.bodyDef.type=box2d.b2BodyType.b2_dynamicBody}else{this.bodyDef.type=box2d.b2BodyType.b2_staticBody}this.bodyDef.allowSleep=false;this.polygonShape=new box2d.b2PolygonShape;this.polygonShape.SetAsBox(this.model.props.sizew/2/gg.scaling,this.model.props.sizeh/2/gg.scaling);this.fixtureDef=new box2d.b2FixtureDef;this.fixtureDef.shape=this.polygonShape;this.fixtureDef.density=1;this.bodyDef.position.Set(this.props.x/gg.scaling,this.props.y/gg.scaling);this.dynamicBody=gg.world.CreateBody(this.bodyDef);this.dynamicBody.CreateFixture(this.fixtureDef);this.dynamicBody.SetTransform(this.dynamicBody.GetPosition(),this.props.r);this.dynamicBody.SetLinearDamping(6);this.dynamicBody.SetAngularDamping(5);return true}patch(t){super.patch(t);this.state(t);return 1}pose(){var t,s,e;super.pose();s=this.deltas;for(t in s){e=s[t];e.pose()}return 1}state(s,e){var i,r,n;if(s.states==null){return}i=s.states;if(i.h!=null){gg.play(gg.sounds.impacts[i.h],this,70)}if(i.l!=null){console.log(`headlights is ${i.l}`);if(0===i.l&&true===this.__car.headlights){console.log("rmdelta lights");this.rmdelta(t.head_light_left);this.rmdelta(t.head_light_right);this.__car.headlights=false}else if(1===i.l&&false===this.__car.headlights){console.log("making lights");r=this.delta(t.head_light_left,"Pale Nimbus");n=this.delta(t.head_light_right,"Pale Nimbus");gg.flipplane(r.geometry,0,true);r.material.emissive=n.material.emissive=new THREE.Color(3355443);this.__car.headlights=true}}if(i.b!=null){console.log(`taillights is ${i.b}`);if(0===i.b&&true===this.__car.taillights){this.rmdelta(t.tail_light_left);this.rmdelta(t.tail_light_right);this.__car.taillights=false}else if(1===i.b&&false===this.__car.taillights){r=this.delta(t.tail_light_left,"Radish");n=this.delta(t.tail_light_right,"Radish");gg.flipplane(r.geometry,0,true);r.material.emissive=n.material.emissive=new THREE.Color(2228224);this.__car.taillights=true}}return true}rmdelta(t){var s;console.log("rmdelta "+t);if((s=this.deltas[t.nr])!=null){s.dtor()}delete this.deltas[t.nr];return 0}delta(t,s){var e,i,r,n,a,o;r=t.nr;a={elevation:2,path:`${this.path.split(".png")[0]}_deltas.png`,salt:s,hasShadow:false,sprite:{width:this.model.props.width,height:this.model.props.height}};i=this.model.deltas[r];o=(e=this.deltas)[n=`${r}`]!=null?e[n]:e[n]=new gg.Sprite(this.props,a);gg.posplane(o.geometry,0,i.x,i.y,i.w,i.h);o.build(true);return o}dooring(s,e){var i,r,n;r=this.model.props.doors[s];n="right"===r.side;if(!n){if(s<2){switch(e){case 0:this.rmdelta(t.driver_door_open);break;case 1:this.rmdelta(t.driver_door_almost_open);this.delta(t.driver_door_open);break;case 2:this.rmdelta(t.driver_door_open);this.rmdelta(t.driver_door_slightly_open);this.delta(t.driver_door_almost_open);break;case 3:this.rmdelta(t.driver_door_almost_open);this.rmdelta(t.driver_door_almost_closed);this.delta(t.driver_door_slightly_open);break;case 4:this.rmdelta(t.driver_door_slightly_open);this.delta(t.driver_door_almost_closed);break;case 5:this.rmdelta(t.driver_door_almost_closed)}}else{switch(e){case 0:this.rmdelta(t.rear_door_left_open);break;case 1:this.rmdelta(t.rear_door_left_almost_open);this.delta(t.rear_door_left_open);break;case 2:this.rmdelta(t.rear_door_left_open);this.rmdelta(t.rear_door_left_slightly_open);this.delta(t.rear_door_left_almost_open);break;case 3:this.rmdelta(t.rear_door_left_almost_open);this.rmdelta(t.rear_door_left_almost_closed);this.delta(t.rear_door_left_slightly_open);break;case 4:this.rmdelta(t.rear_door_left_slightly_open);this.delta(t.rear_door_left_almost_closed);break;case 5:this.rmdelta(t.rear_door_left_almost_closed)}}}else{i=null;if(s<2){switch(e){case 0:this.rmdelta(t.passenger_door_open);break;case 1:this.rmdelta(t.passenger_door_almost_open);i=this.delta(t.passenger_door_open);break;case 2:this.rmdelta(t.passenger_door_open);this.rmdelta(t.passenger_door_slightly_open);i=this.delta(t.passenger_door_almost_open);break;case 3:this.rmdelta(t.passenger_door_almost_open);this.rmdelta(t.passenger_door_almost_closed);i=this.delta(t.passenger_door_slightly_open);break;case 4:this.rmdelta(t.passenger_door_slightly_open);i=this.delta(t.passenger_door_almost_closed);break;case 5:this.rmdelta(t.passenger_door_almost_closed)}}else{switch(e){case 0:this.rmdelta(t.rear_door_right_open);break;case 1:this.rmdelta(t.rear_door_right_almost_open);i=this.delta(t.rear_door_right_open);break;case 2:this.rmdelta(t.rear_door_right_open);this.rmdelta(t.rear_door_right_slightly_open);i=this.delta(t.rear_door_right_almost_open);break;case 3:this.rmdelta(t.rear_door_right_almost_open);this.rmdelta(t.rear_door_right_almost_closed);i=this.delta(t.rear_door_right_slightly_open);break;case 4:this.rmdelta(t.rear_door_right_slightly_open);i=this.delta(t.rear_door_right_almost_closed);break;case 5:this.rmdelta(t.rear_door_right_almost_closed)}}if(i!=null){gg.flipplane(i.geometry,0,true)}}this.pose();return 0}lights(){if(!(this.engineon&&gg.settings.fancyHeadlights)){return}this.headlights=new THREE.SpotLight(16777215);this.headlights.intensity=1;this.headlights.angle/=2.5;this.headlights.penumbra=.25;this.headlights.decay=1.5;this.headlights.distance=64*5;gg.scene.add(this.headlights);gg.scene.add(this.headlights.target);return 1}step(){var t,s,e,i,r,n,a,o;if((this.driver||this.passenger)&&gg.keys[69]===1){this.exit();return}else if(this.driver){i=this.dynamicBody.GetPosition();this.props.x=i.x*gg.scaling;this.props.y=i.y*gg.scaling;this.props.r=this.dynamicBody.GetAngle();this.pose();if(!this.engineon){if(this.readytime<=Date.now()){this.engineon=true;gg.zoom=gg.C.ZOOM.CAR;this.lights()}else{return}}}else{super.step();this.dynamicBody.SetPosition(new box2d.b2Vec2(this.props.x/gg.scaling,this.props.y/gg.scaling));this.dynamicBody.SetTransform(this.dynamicBody.GetPosition(),this.props.r);this.dynamicBody.SetAngularVelocity(0);this.dynamicBody.SetLinearVelocity(new box2d.b2Vec2(0,0));this.pose();if(this.passenger){gg.zoom=gg.C.ZOOM.CAR}return}if(gg.settings.fancyHeadlights){t=gg.pivot(this.props.x,this.props.y-this.model.props.height/2+32,this.props.r,this.props.x,this.props.y);this.headlights.position.set(t.x,t.y,this.props.z+36);t=gg.pivot(this.props.x,this.props.y-this.model.props.height/2,this.props.r,this.props.x,this.props.y);this.headlights.target.position.set(t.x,t.y,this.props.z+16)}this.gas=!!gg.keys[87]&&!gg.keys[83];this.brake=!!gg.keys[83]&&!gg.keys[87];this.left=!!gg.keys[65]&&!gg.keys[68];this.props.right=!!gg.keys[68]&&!gg.keys[65];this.springing();s=!this.gas&&!this.reversing;if(this.lastb!==s){gg.net.out.b=s}this.lastb=s;this.reversing=this.gas;a=false;if(this.phys.spring){o=this.phys.spring;if(a){o=-this.phys.spring}r=this.model.phys.drotate*o;e=this.dynamicBody.GetLinearVelocity().Length();r*=e/10/this.model.wheelbase;this.dynamicBody.ApplyTorque(r*1e5)}if(this.phys.slipness>0){this.phys.slipness-=.05}this.phys.slip=Math.abs(this.phys.lastr-this.props.r)*(this.phys.push/this.model.phys.max)*10;if(this.phys.slip>=.5){this.phys.push-=this.model.phys.dslip*.01666;if(this.phys.slipness<1){this.phys.slipness+=.2}}if(this.gas&&this.phys.push<this.model.phys.max){this.phys.push+=this.model.phys.daccelerate*.01666;if(this.phys.push<0){this.phys.push+=this.model.phys.dbrake*.01666}}else if(this.brake){this.dobrake()}this.propel();n=this.phys.push/10;this.phys.lastr=this.props.r;super.step();return true}springing(){var t;t=.1;if(this.left){this.phys.spring=this.phys.spring<1?this.phys.spring+t:1}else if(this.props.right){this.phys.spring=this.phys.spring>-1?this.phys.spring-t:-1}else if(this.phys.spring){if(this.phys.spring>0){this.phys.spring=this.phys.spring-t<0?0:this.phys.spring-t}else if(this.phys.spring<0){this.phys.spring=this.phys.spring+t>0?0:this.phys.spring+t}}return true}dobrake(){if(this.phys.push>0){this.reversing=false;if(this.phys.push-this.model.phys.dbrake*.01666>0){this.phys.push-=this.model.phys.dbrake*.01666}else{this.phys.push=0}}else{this.reversing=true;if(this.phys.push>-this.model.phys.bmax&&this.phys.push-this.model.phys.dreverse*.01666>-this.model.phys.bmax){this.phys.push-=this.model.phys.dreverse*.01666}else{this.phys.push=-this.model.phys.bmax}}return true}propel(){var t,s,e,i,r,n;if(!this.gas&&!this.brake){s=this.model.phys.droll*.01666;if(this.phys.push-s>0){this.phys.push-=s}else if(this.phys.push+s<0){this.phys.push+=s}else{this.phys.push=0}}t=this.props.r-Math.PI/2;e=150;r=this.phys.push*e*Math.cos(t);n=this.phys.push*e*Math.sin(t);i=new box2d.b2Vec2(r,n);this.dynamicBody.ApplyForce(i,this.dynamicBody.GetWorldCenter());return true}reset(){this.phys.push=0;this.phys.spring=0;this.phys.slip=0;this.phys.stiff=0;return 1}enter(t){if(t!==gg.ply){return}this.reset();this.passenger=0!==t._MAN._cd.i;this.driver=!this.passenger;if(!this.passenger){gg.bubble("You're driving.");this.props.net=false}else{gg.bubble("This is a passenger seat.");this.props.net=true}this.embody();t.car=this;gg.ply=this;this.readytime=Date.now()+750;return true}exit(){var t;this.props.net=true;gg.net.out.EXITCAR=true;this.passenger=false;this.driver=false;if(gg.settings.fancyHeadlights){gg.scene.remove(this.headlights);gg.scene.remove(this.headlights.target)}gg.play(gg.sounds.cardoor[0],this);t=(()=>{return gg.play(gg.sounds.cardoor[1],this)});setTimeout(t,600);gg.zoom=gg.C.ZOOM.PED;this.readytime=0;this.engineon=false;gg.net.out.CAR=[this.props.x,this.props.y,this.props.r,this.props.z];return 1}};gg.Cars=class s{constructor(s){var e,i,r,n,a,o,h,l,g,p;this.props=s;if(this.props.colors==null){this.props.colors=[]}this.speed=this.props.speed||.5;this.wheelbase=this.props.wheelbase||2;this.handling=this.props.handling||.5;this.weight=this.props.weight||.001*15;this.grip=this.props.grip||.5;o=this.speed*10;this.phys={max:o,bmax:o/2.5,drotate:this.props.handling/100,daccelerate:o/2.5,dbrake:o*2,dreverse:o/4,droll:o/3,dslip:o*2.5,airFriction:this.grip*.02+.04};this.deltas={};for(a in t){h=t[a];r=h.y===1?0:1;i=this.props.width*10+9*4;e=this.props.height*2+4;g=h.x*this.props.width+h.x*4;p=r*this.props.height+r*4;l=this.props.width;n=this.props.height;this.deltas[`${h.nr}`]={x:g/i,y:p/e,w:l/i,h:n/e}}}};gg.Cars.TYPES={};t={dent_behind_left:{nr:"1",x:0,y:0},dent_behind_right:{nr:"2",x:1,y:0},dent_front_right:{nr:"3",x:2,y:0},dent_front_left:{nr:"4",x:3,y:0},unused_original_vehicles_have_a_dent_in_the_roof_here:{nr:"5",x:4,y:0},tail_light_right:{nr:"6",x:5,y:0},tail_light_left:{nr:"6.5",x:5,y:0},head_light_right:{nr:"7",x:6,y:0},head_light_left:{nr:"7.5",x:6,y:0},driver_door_almost_closed:{nr:"8",x:7,y:0},driver_door_slightly_open:{nr:"9",x:8,y:0},driver_door_almost_open:{nr:"10",x:9,y:0},driver_door_open:{nr:"11",x:0,y:1},passenger_door_almost_closed:{nr:"8.5",x:7,y:0},passenger_door_slightly_open:{nr:"9.5",x:8,y:0},passenger_door_almost_open:{nr:"10.5",x:9,y:0},passenger_door_open:{nr:"11.5",x:0,y:1},rear_door_left_almost_closed:{nr:"12",x:1,y:1},rear_door_left_slightly_open:{nr:"13",x:2,y:1},rear_door_left_almost_open:{nr:"14",x:3,y:1},rear_door_left_open:{nr:"15",x:4,y:1},rear_door_right_almost_closed:{nr:"12.5",x:1,y:1},rear_door_right_slightly_open:{nr:"13.5",x:2,y:1},rear_door_right_almost_open:{nr:"14.5",x:3,y:1},rear_door_right_open:{nr:"15.5",x:4,y:1}}}).call(this);(function(){gg.C.faceNames=["right","left","front","back","top","bottom"];gg.C.faceNamesOpposite=["left","right","back","front","bottom","top"];gg.C.rotateNames=["rright","rleft","rfront","rback","rtop","rbottom"];gg.C.faces={0:0,1:0,2:1,3:1,4:2,5:2,6:3,7:3,8:4,9:4};gg.Block=class t extends gg.Visual{constructor(t){var s;super(t);this.type="Block";if(t.r==null){t.r=0}if(t.f==null){t.f=0}this.top=4;s=(t.z+1)*64;this.raise={z:s,tl:s,tr:s,bl:s,br:s,mean:s};this.tile=`${Math.floor(this.props.x)},${Math.floor(this.props.y)}`}dtor(){var t;if((t=this.chunk)!=null){delete t.tiles[this.tile]}if(this.body!=null){gg.world.DestroyBody(this.body)}super.dtor();return 1}build(t){var s,e;console.log("block build");this.shape();this.pose();if((s=this.chunk.tiles)[e=this.tile]==null){s[e]=[]}this.chunk.tiles[this.tile].push(this);super.build(t);return 1}pose(){var t,s,e;t=this.props.x*64+32;s=this.props.y*64+32;e=this.props.z*64+32;if(this.mesh){this.mesh.position.x=t;this.mesh.position.y=s;this.mesh.position.z=e}this.mesh.updateMatrix();this.mesh.updateMatrixWorld();if(!this.body&&this.props.z===1){this.embody()}return true}shape(){var t,s,e,i;this.makematerials();if(this.props.s!=null||this.props.w!=null||gg.ed!=null){this.geometry=gg.box.clone()}else if(gg.ed==null){t="";for(e=i=0;i<=4;e=++i){t+=this.props[gg.C.faceNames[e]]!=null?"1":"0"}this.bin=t=t.toString().replace(/[\s,]/g,"");s=gg.boxes[`${t}`];this.top=s.gg.top;this.geometry=s.clone()}if(this.props.f){gg.flipplane(this.geometry,this.top,true)}if(this.props.r){gg.rotateplane(this.geometry,this.top,this.props.r)}this.slope();this.wedge();this.material=this.materials;this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.castShadow=true;this.mesh.receiveShadow=false;this.mesh.matrixAutoUpdate=false;gg.block=this;this.mesh.ggsolid=this;return 1}slope(){var t,s,e,i,r;if(this.props.s==null){return}i=this.props.s;for(t in i){s=i[t];if(!s){continue}e=this.geometry.attributes.position.array;this.geometry.attributes.position.needsUpdate=true;r=32+8*s;switch(parseInt(t)){case 0:this.raise.tl=this.raise.z+r;this.raise.tr=this.raise.z+r;e[2]=r;e[17]=r;e[32]=r;e[35]=r;e[50]=r;e[53]=r;break;case 1:this.raise.tr=this.raise.z+r;this.raise.br=this.raise.z+r;e[35]=r;e[41]=r;e[2]=r;e[8]=r;e[53]=r;e[59]=r;break;case 2:this.raise.bl=this.raise.z+r;this.raise.br=this.raise.z+r;e[8]=r;e[23]=r;e[38]=r;e[41]=r;e[59]=r;e[56]=r;break;case 3:this.raise.tl=this.raise.z+r;this.raise.bl=this.raise.z+r;e[32]=r;e[38]=r;e[17]=r;e[23]=r;e[50]=r;e[56]=r}}this.raise.mean=(this.raise.tl+this.raise.tr+this.raise.bl+this.raise.br)/4;return 1}wedge(){var t,s,e,i,r;if(this.props.w==null){return}i=this.props.w;for(s in i){t=i[s];if(!t){continue}e=this.geometry.attributes.position.array;this.geometry.attributes.position.needsUpdate=true;r=32;switch(parseInt(s)){case 0:e[0]=-32;e[3]=-32;e[33]=-32;e[27]=-32;e[51]=-32;break;case 1:e[6]=-32;e[9]=-32;e[39]=-32;e[45]=-32;e[57]=-32;break;case 2:e[18]=32;e[21]=32;e[36]=32;e[42]=32;e[54]=32;break;case 3:}}return 1}makematerials(){var t,s,e,i,r,n;this.materials=[];r=gg.C.faceNames;for(s=e=0,i=r.length;e<i;s=++e){t=r[s];if(this.props[t]!=null){if(s===4){n=this.props.s!=null?"Sloped":"";this.materials[s]=gg.material(this.props[t],this,n,true)}else{this.materials[s]=gg.material(this.props[t],this,"Lamb",true)}}else{this.materials[s]=gg.ed==null?gg.C.invisible:gg.material("special/null/null.bmp")}}return true}step(){return 1}embody(){var t,s;if(this.props.interior){return}this.bodyDef=new box2d.b2BodyDef;this.bodyDef.type=box2d.b2BodyType.b2_staticBody;t=(this.props.x+.5)*64/gg.scaling;s=(this.props.y+.5)*64/gg.scaling;this.bodyDef.position.Set(t,s);this.polygonShape=new box2d.b2PolygonShape;this.polygonShape.SetAsBox(32/gg.scaling,32/gg.scaling);this.fixtureDef=new box2d.b2FixtureDef;this.fixtureDef.shape=this.polygonShape;this.fixtureDef.filter.categoryBits=gg.masks.solid;this.fixtureDef.filter.maskBits=-1;this.body=gg.world.CreateBody(this.bodyDef);this.body.CreateFixture(this.fixtureDef);return true}}}).call(this);(function(){gg.Surface=class t extends gg.Visual{constructor(t){var s;super(t);this.type="Surface";if(t.r==null){t.r=0}if(t.f==null){t.f=0}s=t.z*64;this.raise={z:s,tl:s,tr:s,bl:s,br:s,mean:s};this.tile=`${Math.floor(this.props.x)},${Math.floor(this.props.y)}`}dtor(){var t;if((t=this.chunk)!=null){delete t.tiles[this.tile]}super.dtor();return 1}build(t){var s,e;this.shape();this.pose();if((s=this.chunk.tiles)[e=this.tile]==null){s[e]=[]}this.chunk.tiles[this.tile].push(this);super.build(t);return 1}pose(){this.mesh.position.set(this.props.x*64+32,this.props.y*64+32,this.props.z*64);this.mesh.updateMatrix();this.mesh.updateMatrixWorld();return 1}slope(){var t,s,e,i,r;if(this.props.s==null){return}i=this.props.s;for(t in i){s=i[t];if(!s){continue}e=this.geometry.attributes.position.array;this.geometry.attributes.position.needsUpdate=true;r=8*s;switch(parseInt(t)){case 0:this.raise.tr=this.raise.z+r;this.raise.tl=this.raise.z+r;e[2]=r;e[5]=r;break;case 1:this.raise.tr=this.raise.z+r;this.raise.br=this.raise.z+r;e[5]=r;e[11]=r;break;case 2:this.raise.bl=this.raise.z+r;this.raise.br=this.raise.z+r;e[8]=r;e[11]=r;break;case 3:this.raise.tl=this.raise.z+r;this.raise.bl=this.raise.z+r;e[2]=r;e[8]=r}}this.raise.mean=(this.raise.tl+this.raise.tr+this.raise.bl+this.raise.br)/4;return 1}shape(){var t;if("special/water/1.bmp"===this.props.sty){this.material=gg.water}else{t=this.props.s!=null?"Sloped":"";this.material=gg.material(this.props.sty,this,t,false)}this.geometry=new THREE.PlaneBufferGeometry(64,64,1,1);if(this.props.f){gg.flipplane(this.geometry,0,true)}if(this.props.r){gg.rotateplane(this.geometry,0,this.props.r)}this.slope();this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.castShadow=false;this.mesh.receiveShadow=true;this.mesh.matrixAutoUpdate=false;this.mesh.ggsolid=this;return 1}}}).call(this);(function(){var t,s;s=[[0,1],[1,0],[0,-1],[-1,0]];t={"Gunstore A":{sty:"gunstore",depth:32,width:256,height:32},"Centre Hotel":{sty:"centre hotel",depth:28,width:256,height:32}};gg.Neon=class e extends gg.Visual{constructor(s){super(s);this.type="Neon";this.model=t[this.vjson.neon];gg.neon=this;this.width=this.vjson.width||64;this.height=this.vjson.height||3;this.depth=this.vjson.depth||16;this.timer=0;this.pixel=0;if(gg.interior!=null&&gg.interior.name===this.vjson.hiddenfor){return}this.shape();if(this.model!=null){this.board()}this.pose()}build(){if(this.mesh!=null){gg.scene.add(this.mesh)}if(this.boardmesh!=null){gg.scene.add(this.boardmesh)}return true}dtor(){if(this.mesh!=null){gg.scene.remove(this.mesh)}if(this.boardmesh!=null){gg.scene.remove(this.boardmesh)}return true}step(){var t,s;if(!(this.mesh!=null&&this.model!=null)){return}this.timer+=gg.delta;if(this.timer>.07){this.timer=0;this.pixel+=1;if(this.pixel>this.model.width){this.pixel-=this.model.width}}t=this.pixel/this.model.width;s=(1-this.depth/this.model.height)/2;return gg.posplane(this.geometry,0,t,s,this.width/this.model.width,this.depth/this.model.height)}pose(){var t,e;t=s[this.props.r][0];e=s[this.props.r][1];this.mesh.position.x=this.props.x*64+32+t*(64-this.height)/2;this.mesh.position.y=this.props.y*64+32+e*(64-this.height)/2;this.mesh.position.z=this.props.z*64+(64-this.depth)/2+this.depth/2;this.mesh.rotation.z=-(Math.PI/2)*this.props.r;if(this.boardmesh==null){return}this.boardmesh.position.x=this.props.x*64+32-t*this.height/2+t*(64-this.height)/2;this.boardmesh.position.y=this.props.y*64+32-e*this.height/2+e*(64-this.height)/2;this.boardmesh.position.z=this.props.z*64+(64-this.depth)/2+this.depth/2;this.boardmesh.rotation.x=Math.PI/2;this.boardmesh.rotation.y=-(Math.PI/2)*this.props.r;return true}shape(){var t,s,e,i,r,n;r=[];n=gg.C.faceNames;for(s=e=0,i=n.length;e<i;s=++e){t=n[s];r[s]=gg.material("metal/conveyor/310.bmp")}r[3].map=gg.loadSty("misc/a/neonpixels.bmp");r[3].specularMap=r[3].map;r[3].specular=new THREE.Color(16777215);r[3].map.wrapT=THREE.RepeatWrapping;r[3].map.wrapS=THREE.RepeatWrapping;this.material=r;this.geometry=new THREE.BoxBufferGeometry(this.width,this.height,this.depth);gg.posplane(this.geometry,4,0,.5,this.width/64,this.height/64);gg.posplane(this.geometry,0,0,.5,this.height/64,this.depth/64);gg.posplane(this.geometry,1,0,.5,this.height/64,this.depth/64);gg.posplane(this.geometry,2,0,.5,this.width/64,this.depth/64);gg.posplane(this.geometry,3,0,.5,this.width/64,this.depth/64);gg.rotateplane(this.geometry,0,3);gg.rotateplane(this.geometry,1,1);gg.rotateplane(this.geometry,2,2);this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.ggsolid=this;return 1}board(){var t,s;s=gg.loadSty(`nontile/neons/${this.model.sty}.png`);s.wrapT=THREE.RepeatWrapping;s.wrapS=THREE.RepeatWrapping;t=gg.material(`nontile/neons/${this.model.sty}.png`);this.geometry=new THREE.PlaneBufferGeometry(this.width,this.depth,1);this.boardmesh=new THREE.Mesh(this.geometry,t);return 1}}}).call(this);(function(){gg._lights=0;gg.Light=function(){class t extends gg.Entity{constructor(t){super(t);this.type="Light";this.light=null;this.grid=true;this.color=16777215;this.shape();this.pose();gg.map.build=true}pose(){var t;if((t=this.light)!=null){t.position.set(this.props.x*64+32,this.props.y*64+32,this.props.z*64+32)}return 1}shape(){var t,s,e;s=this.props.interior?.65:1.25;e=this.props.interior?64*4:64*4;if(this.vjson.intensity){s=this.vjson.intensity}if(this.vjson.radius){e=this.vjson.radius*64}t=14404490;this.light=new THREE.PointLight(t,s,e);this.light.castShadow=false;if(this.vjson.color!=null){this.light.color.setHex(this.vjson.color)}this.light._visual=this;return 1}reload(){this.light.color.setHex(this.vjson.color||16777215);if(this.vjson.intensity!=null){this.light.intensity=this.vjson.intensity}if(this.vjson.radius!=null){this.light.distance=this.vjson.radius*64}return 1}build(t=false){return 0}dtor(){var t;if((t=this.light)!=null){t._visual=null}return 1}}t.color=16645996;return t}.call(this)}).call(this);(function(){var t,s;s=[[0,31.95],[31.95,0],[0,-31.95],[-31.95,0]];t=[[0,32.05],[32.05,0],[0,-32.05],[-32.05,0]];gg.Door=class e extends gg.Visual{constructor(t){super(t);this.type="Door";gg.door=this;this.path="zaibatsu";if(this.vjson.door!=null){this.path=this.vjson.door}this.path=`nontile/doors/${this.path}.png`;this.shape();this.pose()}build(){gg.scene.add(this.mesh);return true}dtor(){gg.scene.remove(this.mesh);return true}step(){return 0}pose(){var e,i;e=gg.interior!=null&&this.vjson.to===gg.interior.name;i=!e?s:t;if(this.vjson.door==="hidden"&&!e){this.material.opacity=0}this.mesh.position.x=this.props.x*64+32+i[this.props.r][0];this.mesh.position.y=this.props.y*64+32+i[this.props.r][1];this.mesh.position.z=this.props.z*64+24;this.mesh.rotation.x=Math.PI/2;this.mesh.rotation.y=-(Math.PI/2)*this.props.r;return true}shape(){this.material=gg.material(this.path);if("hidden"===this.vjson.door){this.material.color.setHex(394758)}this.geometry=new THREE.PlaneBufferGeometry(32,48,1);this.mesh=new THREE.Mesh(this.geometry,this.material);this.mesh.ggsolid=this;return true}}}).call(this);(function(){var t,s;s={"Ol' Factory":{sty:"interior/woody/902.bmp"},Vault:{corner:"metal/green/359b.bmp",rotates:true,middle:"metal/green/358.bmp",left:"metal/green/381.bmp",right:"metal/green/381.bmp",front:"metal/green/381.bmp",back:"metal/green/381.bmp",foundation:"floors/green/645.bmp",wall:"metal/green/381.bmp"},Hall:{corner:"interior/hall/346.bmp",rotates:false,middle:"interior/hall/346.bmp",left:"interior/hall/346.bmp",right:"interior/hall/346.bmp",front:"interior/hall/346.bmp",back:"interior/hall/346.bmp",foundation:"interior/hall/346.bmp",wall:"interior/hall/346.bmp"},Lounge:{shininess:30,sty:"interior/lounge/sty.bmp",rotates:false}};gg.Interior=class e{constructor(e,i){var r,n,a,o,h,l,g,p,u,d,c,m,f,y,v,b,w,_;this.name=e;this.style=i;this.hidden=[];this.visuals=[];this.floors=[];this.walls=[];this.doors=[];this.intrblocks=[];this.style=s[this.style];y=gg.map.actives;for(o=0,g=y.length;o<g;o++){n=y[o];v=n.visuals;for(h=0,p=v.length;h<p;h++){_=v[h];if(_.vjson==null){continue}if(_.type==="Block"&&_.vjson.of===this.name){_.props.hide=true;this.hidden.push(_);if(_.vjson.floor===0){m={type:"Surface",chunk:n,shininess:this.style.shininess||0,interior:this.name,x:_.props.x,y:_.props.y,z:_.props.z};this.floors.push(m);m={type:"Surface",x:_.props.x,y:_.props.y,z:_.props.z-.3}}}}}b=this.floors;for(l=0,u=b.length;l<u;l++){f=b[l];r={type:"Block",interior:this.name,x:f.x,y:f.y,z:f.z,right:this.style.right,left:this.style.left,front:this.style.front,back:this.style.back};w=this.floors;for(c=0,d=w.length;c<d;c++){a=w[c];if(f.x===a.x&&f.y===a.y+1){delete r.back}if(f.x===a.x&&f.y===a.y-1){delete r.front}if(f.x===a.x+1&&f.y===a.y){delete r.left}if(f.x===a.x-1&&f.y===a.y){delete r.right}}f.sty=this.style.middle||this.style.sty;if(!this.style.rotates){f.normal=true}this.visuals.push(f.chunk.addr(f));if(r.left&&r.front&&!r.right&&!r.back){if(this.style.corner){f.sty=this.style.corner;if(this.style.rotates){f.r=0}}this.intrblocks.push(new t({x:f.x-1,y:f.y,r:0*Math.PI}));this.intrblocks.push(new t({x:f.x,y:f.y+1,r:0*Math.PI}))}else if(r.right&&r.front&&!r.left&&!r.back){if(this.style.corner){f.sty=this.style.corner;if(this.style.rotates){f.r=1}}this.intrblocks.push(new t({x:f.x+1,y:f.y,r:1*Math.PI}));this.intrblocks.push(new t({x:f.x,y:f.y+1,r:1*Math.PI}))}else if(r.right&&r.back&&!r.left&&!r.front){if(this.style.corner){f.sty=this.style.corner;if(this.style.rotates){f.r=2}}this.intrblocks.push(new t({x:f.x+1,y:f.y,r:2*Math.PI}));this.intrblocks.push(new t({x:f.x,y:f.y-1,r:2*Math.PI}))}else if(r.left&&r.back&&!r.right&&!r.front){if(this.style.corner){f.sty=this.style.corner;if(this.style.rotates){f.r=3}}this.intrblocks.push(new t({x:f.x-1,y:f.y,r:3*Math.PI}));this.intrblocks.push(new t({x:f.x,y:f.y-1,r:3*Math.PI}))}}}dtor(){var t,s,e,i,r,n,a,o,h,l,g;o=this.hidden;for(s=0,r=o.length;s<r;s++){g=o[s];delete g.props.hide}h=this.visuals;for(e=0,n=h.length;e<n;e++){g=h[e];g.chunk.removev(g)}l=this.intrblocks;for(i=0,a=l.length;i<a;i++){t=l[i];t.dtor()}}};t=class t{constructor(t){var s,e,i;this.bf=new box2d.b2BodyDef;this.bf.type=box2d.b2BodyType.b2_staticBody;e=(t.x+.5)*64/gg.scaling;i=(t.y+.5)*64/gg.scaling;this.bf.position.Set(e,i);this.polygonShape=new box2d.b2PolygonShape;this.polygonShape.SetAsBox(32/gg.scaling,32/gg.scaling);s=new box2d.b2FixtureDef;s.shape=this.polygonShape;s.filter.categoryBits=gg.masks.intrsolid;s.filter.maskBits=gg.masks.introrganic;this.body=gg.world.CreateBody(this.bf);this.body.SetTransform(this.body.GetPosition(),t.r);this.fixture=this.body.CreateFixture(s)}dtor(){gg.world.DestroyBody(this.body);return true}}}).call(this);(function(){gg.Activator=function(){class t extends gg.Sprite{constructor(s){var e,i,r;if(s.id==null){s.id=--t.prototype.idpool}i=gg.activators[s.type]||gg.activators.err;if(i.anim!=null){e=JSON.parse(JSON.stringify(i.anim))}r={elevation:i.elevation,path:i.texture,hasShadow:i.hasShadow,x:i.x||0,sprite:{width:i.sprite.width,height:i.sprite.height},sheet:{width:i.sheet.width,height:i.sheet.height}};super(s,r);this.understeer=false;this.anim=e;this.model=i;this.build();this.type="Activator";this.frame(i.frame||0,i.y);if(i.solid){this.embody()}this.state(s,true);this.pose()}patch(t){super.patch(t);this.state(t);return true}embody(){var t,s;this.bodyDef=new box2d.b2BodyDef;this.bodyDef.type=box2d.b2BodyType.b2_staticBody;t=this.props.x/gg.scaling;s=this.props.y/gg.scaling;this.bodyDef.position.Set(t,s);this.polygonShape=new box2d.b2PolygonShape;this.polygonShape.SetAsBox(this.model.sprite.width/2/gg.scaling,this.model.sprite.height/2/gg.scaling);this.fixtureDef=new box2d.b2FixtureDef;this.fixtureDef.shape=this.polygonShape;this.fixtureDef.filter.categoryBits=gg.masks.solid;this.fixtureDef.filter.maskBits=-1;this.body=gg.world.CreateBody(this.bodyDef);this.body.SetTransform(this.body.GetPosition(),this.props.r);this.body.CreateFixture(this.fixtureDef);return true}dtor(){this.mesh.ggsolid=null;super.dtor(1);return true}state(){return 0}step(){var t;super.step();if(this.anim!=null){gg.anim.call(this.anim);t=this.anim.i;this.frame(t,this.model.y)}this.pose();return true}}t.prototype.idpool=0;return t}.call(this);gg.Furniture=class t extends gg.Activator{constructor(t){super(t)}};gg.ATM=class t extends gg.Activator{constructor(t){super(t)}state(t){}gui(){return 0}dtor(){return super.dtor()}};gg.VendingMachine=class t extends gg.Activator{constructor(t){super(t)}state(t){}gui(){return 0}dtor(){return super.dtor()}};gg.LabFreezer=class t extends gg.Activator{constructor(t){var s,e;super(t);s=t.x+5*Math.cos(t.r-Math.PI/2);e=t.y+5*Math.sin(t.r-Math.PI/2)}gui(){return 0}dtor(){gg.scene.remove(this.light);return super.dtor()}};gg.VacuumOven=class t extends gg.Activator{constructor(t){var s,e;super(t);s=t.x+5*Math.cos(t.r-Math.PI/2);e=t.y+5*Math.sin(t.r-Math.PI/2)}gui(){return 0}dtor(){gg.scene.remove(this.light);return super.dtor()}};gg.Incubator=class t extends gg.Activator{constructor(t){var s,e;super(t);s=t.x+8*Math.cos(t.r-Math.PI/2);e=t.y+8*Math.sin(t.r-Math.PI/2)}gui(){return 0}dtor(){gg.scene.remove(this.light);return super.dtor()}};gg.Generator=class t extends gg.Activator{constructor(t){super(t);gg.map.build=true}dtor(){return super.dtor()}};gg.Worklight=class t extends gg.Activator{constructor(t){super(t);this.light=null}state(t){if(t.states==null){return}if(t.states.o!=null){if(t.states.o&&(gg.interior!=null&&t.states.intr!=null||gg.interior==null)){if(this.light==null){this.light=new THREE.PointLight(16777215,2,64*5);this.light.position.set(this.props.x,this.props.y,this.props.z+24);gg.scene.add(this.light);gg.map.build=true}}else if(this.light!=null){gg.scene.remove(this.light);this.light=null;gg.map.build=true}}return true}dtor(){if(this.light!=null){gg.scene.remove(this.light)}return super.dtor()}};gg.Terminal=class t extends gg.Activator{constructor(t){var s,e;super(t);s=t.x+5*Math.cos(t.r-Math.PI/2);e=t.y+5*Math.sin(t.r-Math.PI/2);this.thing="<om:terminal> <om:screen> Terminal... </om:screen> <om:deck> \x3c!-- <om:vent></om:vent> <om:vent></om:vent> <om:vent></om:vent> <om:vent></om:vent> <om:vent></om:vent> --\x3e <om:power>onn</om:power> \x3c!-- <om:knob></om:knob> --\x3e </om:deck> </om:terminal>"}state(t){if(t.states==null){return}return true}dtor(){if(this.light!=null){gg.scene.remove(this.light)}return super.dtor()}};gg.Teleporter=class t extends gg.Activator{constructor(t){super(t);this.light=null;this.topmaterial=new THREE.MeshLambertMaterial({color:!this.props.interior?gg.ambient:gg.intrcolor,map:this.sty,transparent:true,side:THREE.FrontSide});this.topgeometry=new THREE.PlaneBufferGeometry(this.sprite.sprite.width*this.sprite.scale,this.sprite.sprite.height*this.sprite.scale,1);this.topmesh=new THREE.Mesh(this.topgeometry,this.topmaterial);this.topmesh.position.set(this.props.x,this.props.y,this.props.z+12);this.topmesh.rotation.z=this.props.r;gg.scene.add(this.topmesh);this.frame(1,this.model.y,this.topgeometry)}state(t){if(t.states==null){return}if(t.states.o!=null){if(t.states.o&&(gg.interior!=null&&t.states.intr!=null||gg.interior==null)){if(this.light==null){this.light=new THREE.PointLight(12833279,2,256);this.light.position.set(this.props.x,this.props.y,this.props.z+32);gg.scene.add(this.light);gg.map.build=true}}else if(this.light!=null){gg.scene.remove(this.light);this.light=null;gg.map.build=true}}return true}dtor(){gg.scene.remove(this.topmesh);if(this.light!=null){gg.scene.remove(this.light)}return super.dtor()}};gg.Cable=function(){class t{constructor(t){var s;console.log("new cable ");s=this.power}dtor(){}}t.power={sprite:{width:8,height:31},sheet:{width:128,height:128},x:120,y:1-1/128*13,frame:0};return t}.call(this);gg.Dumpster=class t extends gg.Activator{constructor(t){super(t)}}}).call(this);(function(){gg.Pickup=class t extends gg.Sprite{constructor(t){var s,e,i;s=gg.weps[((e=t.states)!=null?e.model:void 0)||t.model];t.z=64;t.r=0;i={elevation:2,path:`nontile/mcitems/${s.sty}.png`,hasShadow:true,sprite:{width:29,height:29}};super(t,i);this.model=s;this.type="Pickup";if(!t.net&&gg.ed==null){t.hide=true}this.build();if(this.yaw==null){this.yaw={value:0,period:0}}}step(){var t,s;s=this.yaw;t=4;s.period+=.02*gg.timestep;if(s.period>Math.PI*2){s.period-=Math.PI*2}s.value=t*Math.cos(s.period);this.sprite.elevation=t+s.value;this.keyframe[2]+=.016*.5;super.step();this.pose();return 1}};gg.Gun=class t{constructor(t,s){}};gg.Melee=class t{constructor(t,s){}};gg.trails=[];gg.Trail=class t{constructor(t){var s;this.props=t;gg.trails.push(this);this.made=Date.now();this.material=new THREE.LineBasicMaterial({color:16777215,transparent:true,opacity:.7});s=new THREE.Geometry;s.vertices.push(new THREE.Vector3(this.props.x,this.props.y,65));s.vertices.push(new THREE.Vector3(this.props.to.x,this.props.to.y,65));this.line=new THREE.Line(s,this.material);gg.scene.add(this.line)}dtor(){var t;gg.scene.remove(this.line);t=gg.trails.indexOf(this);gg.trails.splice(t,1);return true}step(){this.material.opacity-=.05;if(this.made<Date.now()-250){this.dtor()}return true}}}).call(this);(function(){gg.Inventory=class t{constructor(){this.items={};this.it=null;this.using=null;this.object=null;this.sel=null;this.inventory=$('<div id="inventory">');$("#overlay").append(this.inventory);this.build()}dtor(){return this.inventory.remove()}patch(t){this.items=t;this.build();return true}build(){var t,s,e,i,r,n;s=this;this.stuff=$('<div class="in">');r=this.items;for(e in r){n=r[e];t=$('<div class="item">');t.append(`<span class="name">${e}</span>`);if(e===this.using){t.addClass("it");s.it=t}t.click(function(){var t,e,i,r,n,a,o,h,l,g,p,u;a=$(this);if(s.it===a){return}if(s.it!=null){s.it.removeClass("it")}a.addClass("it");s.using=a.children()[0].innerHTML;s.it=a;gg.ply.hold(gg.weps[s.using]||null);gg.net.out.SEL=s.using;u=gg.weps[s.using];if(u!=null){$("#gun").empty();n=$(`<img src="play/sty/nontile/mcitems/${u.sty}.png"></img>`);p=$('<div class="stats">');if(u.damage!=null){i=Math.floor(u.damage/100*100);e=Math.min(i,100).toFixed(0);g=$('<div class="stat">');g.append('<div class="name">Damage/</div>');g.append(`<div class="bar percent"> <div class="value" style="width: ${e}%">${i}</div> </div> <div class="end"></div>`);p.append(g)}if(u.accuracy!=null){t=Math.floor(u.accuracy*100);e=Math.min(t,100).toFixed(0);o=$('<div style="line-height: 0;">');g=$('<div class="stat" style="width: 50%; display: inline-block;">');g.append('<div class="name">Accuracy/</div>');g.append(`<div class="bar percent"> <div class="value" style="width: ${e}%">${t}</div> </div> <div class="end"></div>`);o.append(g);l=Math.floor(u.recoil*100);e=Math.min(l,100).toFixed(0);g=$('<div class="stat" style="width: 50%; display: inline-block;">');g.append('<div class="name" style="padding-left: 2ex;">Recoil/</div>');g.append(`<div class="bar percent"> <div class="value" style="width: ${e}%">${l}</div> </div> <div class="end"></div>`);o.append(g);p.append(o)}if(u.range!=null){h=Math.floor(u.range*100);e=Math.min(h,100).toFixed(0);g=$('<div class="stat">');g.append('<div class="name">Range/</div>');g.append(`<div class="bar percent"> <div class="value" style="width: ${e}%">${h}</div> </div> <div class="end"></div>`);p.append(g)}if(u.firerate){r=u.firerate/20*100;e=Math.min(r,100).toFixed(0);g=$('<div class="stat">');g.append('<div class="name">Firerate/</div>');g.append(`<div class="bar percent"> <div class="value" style="width: ${e}%">${u.firerate}</div> </div> <div class="end"></div>`);p.append(g)}$("#gun").append(n);$("#gun").append(p)}else{$("#gun").html("")}return true});i=n>1?n:"&nbsp";t.append(`<span class="count">${i}</span>`);this.stuff.append(t)}this.inventory.html(this.stuff);return true}}}).call(this);(function(){gg.Settings=function(){class t{constructor(){gg.Settings.prototype.instance=this;this.link=$('<a href="javascript:;">Settings</a><br />');this.link.click(()=>{return this.build()});$("#links").append(this.link)}build(){var t,s,e,i,r,n,a,o,h,l,g;if((a=gg.Tour.prototype.instance)!=null?a.built:void 0){gg.Tour.prototype.instance.destroy()}if((o=gg.Notice.prototype.instance)!=null?o.built:void 0){gg.Notice.prototype.instance.destroy()}if(this.built){return}this.built=true;this.settings=$('<div class="popup" id="settings"></div>');t=$('<div class="content">');t.append("<p>Most options will momentarily freeze the game.</p>");s="";l=$('<p class="switches"></p>');l.append("-Chunks");n=$(`<div class="switch">cache/prefab chunks ${s}</div>`);g=$(`<div class="tick ${gg.settings.prefabChunks?"ya":void 0}"></div>`);g.click(function(){var t,s,e,i,r;r=$(this);if(gg.settings.prefabChunks=!gg.settings.prefabChunks){r.addClass("ya");gg.bubble(`OK...Built ${Object.keys(gg.map.offChunks).length} chunks (prefab)`);e=gg.map.offChunks;i=[];for(s in e){t=e[s];i.push(t.show(true))}return i}else{r.removeClass("ya");gg.bubble("OK...Deep deleting prefabricated chunks");return gg.map.dtor(true)}});n.prepend(g);l.append(n);r=$(`<div class="switch">local materials ${s}</div>`);g=$(`<div class="tick ${gg.settings.localMaterials?"ya":void 0}"></div>`);g.click(function(){var t;t=$(this);if(gg.settings.localMaterials=!gg.settings.localMaterials){t.addClass("ya");gg.bubble("OK...Each chunk reserves it own materials");gg.materials={};return gg.map.dtor(true)}else{t.removeClass("ya");gg.bubble("OK...Sharing materials");gg.materials={};return gg.map.dtor(true)}});r.prepend(g);l.append(r);l.append("<br>-Gfx");i=$('<div class="switch">hotline cam</div>');g=$(`<div class="tick ${gg.settings.hotlineCam?"ya":void 0}"></div>`);g.click(function(){var t;t=$(this);if(gg.settings.hotlineCam=!gg.settings.hotlineCam){t.addClass("ya");return gg.camera.rotation.z=0}else{t.removeClass("ya");return gg.camera.rotation.z=0}});i.prepend(g);l.append(i);h=$('<div class="switch">simple shading</div>');g=$(`<div class="tick ${gg.settings.simpleShading?"ya":void 0}"></div>`);g.click(function(){var t;t=$(this);if(gg.settings.simpleShading=!gg.settings.simpleShading){t.addClass("ya");gg.bubble("OK");gg.materials={};return gg.map.dtor(true)}else{t.removeClass("ya");gg.bubble("OK...Advanced shades for you (h)");gg.materials={};return gg.map.dtor(true)}});h.prepend(g);l.append(h);e=$('<div class="switch">fancy headlights</div>');g=$(`<div class="tick ${gg.settings.fancyHeadlights?"ya":void 0}"></div>`);g.click(function(){var t,s,e,i,r,n,a,o;a=$(this);if(gg.settings.fancyHeadlights=!gg.settings.fancyHeadlights){a.addClass("ya");e=(s=gg.net)!=null?s.visuals:void 0;for(t in e){o=e[t];if(o.type==="Car"){o.lights()}}gg.materials={};return gg.map.dtor(true)}else{a.removeClass("ya");gg.materials={};gg.map.dtor(true);r=(i=gg.net)!=null?i.visuals:void 0;n=[];for(t in r){o=r[t];if(o.type==="Car"&&o.headlights!=null){gg.scene.remove(o.headlights);n.push(gg.scene.remove(o.headlights.target))}else{n.push(void 0)}}return n}});e.prepend(g);l.append(e);this.settings.append(t);this.settings.append(l);this.leave=$('<div class="option">close</div>');this.leave.click(()=>{return this.destroy()});this.options=$('<div class="options"></div>');this.options.append(this.leave);this.settings.append(this.options);$("#overlay").append(this.settings);return true}destroy(){this.settings.remove();this.built=false;return true}}t.prototype.instance=null;return t}.call(this)}).call(this);(function(){var t,s;s="<p> <key>W</key><key>A</key><key>S</key><key>D</key> to move, <key>SPACE</key> to use, <key>Z</key><key>X</key> to zoom in/out<br /> </p> <p> <key>SHIFT</key> to walk/run, <key>E</key> to interact, RIGHT MOUSE to strafe/aim </p> \x3c!--<p> <key>UP</key> to bring up your phone, <key>ENTER</key> and <key>ESC</key> for menus </p>--\x3e <p> <key>F3</key> to toggle minimap </p>";gg.Tour=function(){class t{constructor(){gg.Tour.prototype.instance=this;this.link=$('<a href="javascript:;">Controls</a><br />');this.link.click(()=>{return this.build()});this.slide=-1;$("#links").append(this.link)}build(){var t,e;if((t=gg.Notice.prototype.instance)!=null?t.built:void 0){gg.Notice.prototype.instance.destroy()}if((e=gg.Settings.prototype.instance)!=null?e.built:void 0){gg.Settings.prototype.instance.destroy()}if(this.built){return}this.built=true;this.tour=$('<div class="popup" id="tour">');this.tour.append('<div class="content">'+s+" </div>");this.leave=$('<div class="button">close</div>');this.leave.click(()=>{return this.destroy()});this.options=$('<div class="options">');this.options.append(this.leave);this.tour.append(this.options);$("#overlay").append(this.tour);return true}destroy(){this.tour.remove();this.built=false;return true}}t.prototype.instance=null;return t}.call(this);t='<p>There are guns around the map. This is temporary.</p> <p>Have a look at the <a target="_blank" href="armory">armory</a>.';gg.Notice=function(){class s{constructor(){gg.Notice.prototype.instance=this;this.build()}build(){var s;if((s=gg.Tour.prototype.instance)!=null?s.built:void 0){gg.Tour.prototype.instance.destroy()}if(this.built){return}this.built=true;this.element=$('<div class="popup" id="updates">');this.element.append("<p>Notice</p>");this.element.append(t);this.options=$('<div class="options">');this.leave=$('<div class="next">close</div>');this.leave.click(function(){gg.notice.destroy();return true});this.options.append(this.leave);this.element.append(this.options);$("#overlay").append(this.element);return true}destroy(){this.element.remove();this.built=false;return true}}s.prototype.instance=null;return s}.call(this)}).call(this);(function(){gg.Minimap=class t{constructor(){this.minimap=$('<div id="minimap">');$("#overlay").append(this.minimap);this.build();this.chase()}dtor(){return this.minimap.remove()}build(){var t,s,e,i,r,n,a;this.table=$("<table>");for(a=t=0;t<=4;a=++t){i=$("<tr>");for(n=s=0;s<=4;n=++s){e=$("<td>");r=0;if(gg.map.chunks[a][n]){r=gg.map.chunks[a][n].visuals.length}if(n>0&&n<4&&a>0&&a<4){if(gg.map.chunks[a][n]){e.addClass("inner")}}else if(r){e.addClass("outer")}if(r){e.append(gg.map.chunks[a][n].hash);e.css("opacity",r/50)}if(a===2&&n===2){e.addClass("center")}i.append(e)}this.table.append(i)}this.minimap.html(this.table);return true}chase(){var t,s;if(gg.ply==null){return}t=gg.ply.props.x/gg.C.CHUNITS-gg.map.n.x;s=gg.ply.props.y/gg.C.CHUNITS-gg.map.n.y;s-=1;t*=40;s*=40;t=Math.floor(t);s=Math.floor(s);this.table.css("left",`${-t}px`);this.table.css("top",`${s}px`);t=464;s=400;t-=80;t+=gg.ply.props.x/4;s+=gg.ply.props.y/4;this.minimap.css("background-position-x",`${-t}px`);this.minimap.css("background-position-y",`${s}px`);return true}}}).call(this);